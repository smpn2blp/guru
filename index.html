<!DOCTYPE html>
<!-- saved from url=(0028)https://aah12026.oneapp.dev/ -->
<html lang="id" class="h-full"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrasi Guru</title>
  <script src="./Buku Administrasi Digital Guru_files/element_sdk.js.download"></script>
  <script src="./Buku Administrasi Digital Guru_files/saved_resource"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }

    .grid-pattern {
      background-size: 20px 20px;
      background-image: 
        linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
    }

    .gradient-text {
      background: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #ff0080);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-shift 3s linear infinite;
    }

    @keyframes gradient-shift {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }

    .card-gradient {
      background: linear-gradient(135deg, var(--card-start), var(--card-end));
    }

    .theme-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: var(--switch-bg);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .theme-switch-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .theme-switch.active .theme-switch-slider {
      left: 33px;
    }

    .sidebar {
      transition: transform 0.3s;
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        z-index: 100;
        box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      }
      .sidebar.active {
        transform: translateX(0);
      }
      
      .mobile-menu-btn {
        display: block !important;
      }
      
      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
      }
      
      .mobile-overlay.active {
        display: block;
      }
    }
    
    .mobile-menu-btn {
      display: none;
      padding: 10px 15px;
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 20px;
    }

    * {
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }

    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-color);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-color);
    }

    @media (max-width: 640px) {
      .hide-on-small {
        display: none !important;
      }
    }

    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid var(--accent-color);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    @keyframes checkmark {
      0% {
        transform: scale(0) rotate(45deg);
      }
      50% {
        transform: scale(1.2) rotate(45deg);
      }
      100% {
        transform: scale(1) rotate(45deg);
      }
    }

    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      z-index: 10000;
      animation: slideInRight 0.4s ease-out;
      display: flex;
      align-items: center;
      gap: 15px;
      min-width: 320px;
    }

    .toast-notification.hiding {
      animation: slideOutRight 0.4s ease-in forwards;
    }

    .checkmark-circle {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .checkmark {
      width: 20px;
      height: 20px;
      border-right: 3px solid #10b981;
      border-bottom: 3px solid #10b981;
      transform: rotate(45deg);
      animation: checkmark 0.5s ease-out 0.2s both;
    }

    .auto-save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(16, 185, 129, 0.95);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
    }

    .auto-save-indicator.show {
      opacity: 1;
      transform: translateY(0);
    }

    .pulse-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.2);
      }
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slideOutDown {
      from {
        transform: translateY(0);
        opacity: 1;
      }
      to {
        transform: translateY(100px);
        opacity: 0;
      }
    }

    .color-picker-option {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
      border: 3px solid transparent;
    }

    .color-picker-option:hover {
      transform: scale(1.1);
    }

    .color-picker-option.active {
      border-color: white;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .stat-card {
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    input, textarea, select {
      background: var(--input-bg) !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
    }

    input::placeholder, textarea::placeholder {
      color: var(--placeholder-color) !important;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .mode-card {
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .mode-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .mode-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .mode-card:hover::before {
      left: 100%;
    }

    .class-selector-badge {
      transition: all 0.2s;
      cursor: pointer;
    }

    .class-selector-badge:hover {
      transform: scale(1.05);
    }

    .class-selector-badge.active {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="./Buku Administrasi Digital Guru_files/data_sdk.js.download" type="text/javascript"></script>
 <style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.h-full{height:100%}.w-full{width:100%}.overflow-auto{overflow:auto}</style></head>
 <body class="h-full w-full overflow-auto">
  <div id="app" class="h-full w-full">
        <div style="min-height: 100%; width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;">
          
          <!-- Theme Toggle Button - Posisi Kanan Atas -->
          <div style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
            <div style="background: rgba(255,255,255,0.25); padding: 12px 20px; border-radius: 50px; backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
              <div style="display: flex; align-items: center; gap: 12px;">
                <span style="color: #ffffff; font-size: 13px; font-weight: 600; opacity: 0.9;">Tema:</span>
                <div class="theme-switch " onclick="toggleModeSelectionTheme()" style="position: relative; width: 60px; height: 30px; background: rgba(255,255,255,0.3); border-radius: 15px; cursor: pointer; transition: all 0.3s; border: 2px solid rgba(255,255,255,0.4);">
                  <div class="theme-switch-slider" style="position: absolute; top: 3px; left: 3px; width: 24px; height: 24px; background: white; border-radius: 50%; transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                    ‚òÄÔ∏è
                  </div>
                </div>
                <span style="color: #ffffff; font-size: 13px; font-weight: 600; opacity: 0.9;">Terang</span>
              </div>
            </div>
          </div>

          <div style="max-width: 1200px; width: 100%; animation: fadeIn 0.5s ease-out;">
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 50px;">
              <h1 style="color: #ffffff; font-size: clamp(32px, 5vw, 48px); font-weight: bold; margin-bottom: 15px; text-shadow: 0 4px 12px rgba(0,0,0,0.4); letter-spacing: -0.5px;">
                BUKU ADMINISTRASI GURU
              </h1>
              <p style="color: #ffffff; opacity: 0.95; font-size: clamp(16px, 2.5vw, 20px); line-height: 1.6; max-width: 700px; margin: 0 auto; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                Pilih mode pengguna sesuai dengan peran Anda untuk memulai mengelola data siswa dengan lebih efisien
              </p>
            </div>

            <!-- Mode Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
              <!-- Mode Wali Kelas -->
              <div class="mode-card" onclick="selectMode(&#39;wali_kelas&#39;)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); border: 3px solid rgba(255,255,255,0.2); animation: bounceIn 0.6s ease-out; position: relative; overflow: hidden;">
                
                <!-- Decorative Elements -->
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(30px);"></div>
                
                <div style="position: relative; z-index: 1;">
                  <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3)); animation: float 3s ease-in-out infinite;"></div>
                    <h2 style="color: #ffffff; font-size: 28px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                      MODE WALI KELAS
                    </h2>
                    <div style="width: 60px; height: 4px; background: white; margin: 0 auto; border-radius: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>
                  </div>

                  <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: #ffffff; font-size: 15px; line-height: 1.8; margin-bottom: 20px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">
                      Cocok untuk guru yang menjadi wali kelas dan mengelola <strong>SATU KELAS</strong> secara khusus
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 12px;">
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Fokus pada 1 kelas saja</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Data terkunci pada kelas yang dipilih</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Manajemen siswa lebih terfokus</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Ideal untuk homeroom teacher</span>
                      </div>
                    </div>
                  </div>

                  <button onclick="selectMode(&#39;wali_kelas&#39;); event.stopPropagation();" style="width: 100%; padding: 18px; background: white; color: #667eea; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); transition: all 0.3s;" onmouseover="this.style.transform=&#39;translateY(-3px) scale(1.02)&#39;; this.style.boxShadow=&#39;0 12px 32px rgba(0,0,0,0.4)&#39;" onmouseout="this.style.transform=&#39;translateY(0) scale(1)&#39;; this.style.boxShadow=&#39;0 8px 24px rgba(0,0,0,0.3)&#39;">
                    üéØ PILIH MODE INI
                  </button>
                </div>
              </div>

              <!-- Mode Guru Mata Pelajaran -->
              <div class="mode-card" onclick="selectMode(&#39;guru_mapel&#39;)" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); border: 3px solid rgba(255,255,255,0.2); animation: bounceIn 0.6s ease-out 0.2s both; position: relative; overflow: hidden;">
                
                <!-- Decorative Elements -->
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(30px);"></div>
                
                <div style="position: relative; z-index: 1;">
                  <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3)); animation: float 3s ease-in-out infinite; animation-delay: 0.5s;"></div>
                    <h2 style="color: #ffffff; font-size: 28px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                      MODE GURU MATA PELAJARAN
                    </h2>
                    <div style="width: 60px; height: 4px; background: white; margin: 0 auto; border-radius: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>
                  </div>

                  <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: #ffffff; font-size: 15px; line-height: 1.8; margin-bottom: 20px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">
                      Cocok untuk guru mata pelajaran yang mengajar di <strong>BANYAK KELAS</strong>
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 12px;">
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Kelola banyak kelas sekaligus</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Data terpisah per kelas</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Mudah beralih antar kelas</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: #ffffff; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Ideal untuk subject teacher</span>
                      </div>
                    </div>
                  </div>

                  <button onclick="selectMode(&#39;guru_mapel&#39;); event.stopPropagation();" style="width: 100%; padding: 18px; background: white; color: #f5576c; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); transition: all 0.3s;" onmouseover="this.style.transform=&#39;translateY(-3px) scale(1.02)&#39;; this.style.boxShadow=&#39;0 12px 32px rgba(0,0,0,0.4)&#39;" onmouseout="this.style.transform=&#39;translateY(0) scale(1)&#39;; this.style.boxShadow=&#39;0 8px 24px rgba(0,0,0,0.3)&#39;">
                    üéØ PILIH MODE INI
                  </button>
                </div>
              </div>
            </div>

            <style>
              @keyframes shimmer {
                0%, 100% {
                  opacity: 1;
                  transform: scale(1);
                }
                50% {
                  opacity: 0.85;
                  transform: scale(1.02);
                }
              }

              @keyframes pulse {
                0%, 100% {
                  transform: scale(1);
                }
                50% {
                  transform: scale(1.15);
                }
              }
            </style>
          </div>
        </div>
      </div>
  <div id="autoSaveIndicator" class="auto-save-indicator">
   <div class="pulse-dot"></div><span>Menyimpan otomatis...</span>
  </div>
  <script>
    const defaultConfig = {
      app_title: "BUKU ADMINISTRASI DIGITAL GURU",
      primary_color: "#3b82f6",
      background_color: "#ffffff",
      text_color: "#000000",
      accent_color: "#3b82f6"
    };

    let currentData = [];
    let isDarkTheme = false;
    let accentColor = '#3b82f6';
    let currentMenu = 'dashboard';
    let isLoading = false;
    let autoSaveTimeout = null;
    let autoSaveInterval = null;
    let lastSaveTime = null;

    // Mode dan Kelas Management
    let userMode = null; // 'wali_kelas' atau 'guru_mapel'
    let activeClass = null; // Kelas yang sedang aktif
    let availableClasses = []; // Daftar kelas yang tersedia (untuk guru mapel)

    const accentPresets = [
      { name: 'Biru', color: '#3b82f6' },
      { name: 'Merah', color: '#ef4444' },
      { name: 'Hijau', color: '#10b981' },
      { name: 'Ungu', color: '#8b5cf6' },
      { name: 'Pink', color: '#ec4899' },
      { name: 'Orange', color: '#f97316' },
      { name: 'Cyan', color: '#06b6d4' },
      { name: 'Kuning', color: '#eab308' }
    ];

    // LocalStorage functions
    function loadFromLocalStorage() {
      const stored = localStorage.getItem('bukuGuruData');
      if (stored) {
        try {
          currentData = JSON.parse(stored);
        } catch (e) {
          currentData = [];
        }
      }

      // Load mode dan kelas
      const storedMode = localStorage.getItem('userMode');
      const storedActiveClass = localStorage.getItem('activeClass');
      const storedClasses = localStorage.getItem('availableClasses');

      if (storedMode) {
        userMode = storedMode;
      }

      if (storedActiveClass) {
        activeClass = storedActiveClass;
      }

      if (storedClasses) {
        try {
          availableClasses = JSON.parse(storedClasses);
        } catch (e) {
          availableClasses = [];
        }
      }
    }

    function saveToLocalStorage() {
      localStorage.setItem('bukuGuruData', JSON.stringify(currentData));
      lastSaveTime = new Date();
      showAutoSaveIndicator();
    }

    function saveModeSettings() {
      if (userMode) {
        localStorage.setItem('userMode', userMode);
      }
      if (activeClass) {
        localStorage.setItem('activeClass', activeClass);
      }
      if (availableClasses.length > 0) {
        localStorage.setItem('availableClasses', JSON.stringify(availableClasses));
      }
    }

    function startAutoSave() {
      if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
      }
      
      autoSaveInterval = setInterval(() => {
        if (currentData.length > 0) {
          saveToLocalStorage();
          showMiniNotification('üíæ Data tersimpan otomatis', 'success');
        }
      }, 60000);
    }

    function stopAutoSave() {
      if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
        autoSaveInterval = null;
      }
    }

    function manualSave() {
      saveToLocalStorage();
      showMiniNotification('‚úÖ Data berhasil disimpan!', 'success');
    }

    function backupData() {
      if (currentData.length === 0) {
        showMiniNotification('‚ö†Ô∏è Tidak ada data untuk di-backup', 'warning');
        return;
      }

      const backupData = {
        version: '2.0',
        timestamp: new Date().toISOString(),
        mode: userMode,
        activeClass: activeClass,
        availableClasses: availableClasses,
        data: currentData
      };

      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `buku-guru-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      showMiniNotification('üì• Backup berhasil diunduh!', 'success');
    }

    function restoreData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const backupData = JSON.parse(event.target.result);
            
            if (!backupData.data || !Array.isArray(backupData.data)) {
              showMiniNotification('‚ùå File backup tidak valid', 'error');
              return;
            }

            showRestoreConfirmation(backupData);
          } catch (error) {
            showMiniNotification('‚ùå Gagal membaca file backup', 'error');
          }
        };
        
        reader.readAsText(file);
      };
      
      input.click();
    }

    function showRestoreConfirmation(backupData) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
      `;

      const backupDate = new Date(backupData.timestamp).toLocaleString('id-ID');
      const dataCount = backupData.data.length;

      modal.innerHTML = `
        <div style="background: var(--card-bg); padding: 35px; border-radius: 15px; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
          <div style="text-align: center; margin-bottom: 25px;">
            <div style="font-size: 64px; margin-bottom: 15px;">üì§</div>
            <h3 style="color: var(--text-color); font-size: 24px; font-weight: bold; margin-bottom: 10px;">
              Konfirmasi Restore Data
            </h3>
            <p style="color: var(--text-color); opacity: 0.8; line-height: 1.6;">
              Apakah Anda yakin ingin mengembalikan data dari backup?
            </p>
          </div>

          <div style="background: var(--bg-color); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid ${accentColor};">
            <p style="color: var(--text-color); margin-bottom: 8px;">
              <strong>üìÖ Tanggal Backup:</strong><br>
              ${backupDate}
            </p>
            <p style="color: var(--text-color); margin-bottom: 8px;">
              <strong>üìä Jumlah Data:</strong> ${dataCount} record
            </p>
            <p style="color: var(--text-color);">
              <strong>‚ö° Versi:</strong> ${backupData.version}
            </p>
          </div>

          <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #f59e0b;">
            <p style="color: #92400e; font-size: 14px; line-height: 1.6; margin: 0;">
              <strong>‚ö†Ô∏èÔ∏è Peringatan:</strong> Proses ini akan menggantikan semua data yang ada saat ini dengan data dari backup. Data yang ada sekarang akan hilang.
            </p>
          </div>

          <div style="display: flex; gap: 12px;">
            <button onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 14px; background: #6b7280; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px;">
              ‚ùå Batal
            </button>
            <button onclick="confirmRestore(${JSON.stringify(backupData).replace(/"/g, '&quot;')}); document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 14px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px;">
              ‚úÖ Ya, Restore Data
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function showChangeModeConfirmation() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
      `;

      modal.innerHTML = `
        <div style="background: var(--card-bg); padding: 35px; border-radius: 20px; max-width: 550px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: bounceIn 0.5s ease-out;">
          <div style="text-align: center; margin-bottom: 30px;">
            <div style="font-size: 80px; margin-bottom: 20px;">üîÑ</div>
            <h3 style="color: var(--text-color); font-size: 28px; font-weight: bold; margin-bottom: 15px;">
              Ganti Mode Pengguna?
            </h3>
            <p style="color: var(--text-color); opacity: 0.8; line-height: 1.6; font-size: 15px;">
              Anda akan kembali ke halaman pemilihan mode. Data Anda akan tetap tersimpan.
            </p>
          </div>

          <div style="background: var(--bg-color); padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 4px solid ${accentColor};">
            <p style="color: var(--text-color); font-size: 14px; line-height: 1.6; margin-bottom: 12px;">
              <strong>Mode Saat Ini:</strong> ${userMode === 'wali_kelas' ? 'üë®‚Äçüè´ Wali Kelas' : 'üë©‚Äçüè´ Guru Mata Pelajaran'}
            </p>
            <p style="color: var(--text-color); font-size: 14px; line-height: 1.6; margin: 0;">
              <strong>Kelas Aktif:</strong> ${activeClass || '-'}
            </p>
          </div>

          <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 4px solid #f59e0b;">
            <p style="color: #92400e; font-size: 14px; line-height: 1.6; margin: 0;">
              <strong>üí° Info:</strong> Semua data siswa, nilai, dan absen akan tetap tersimpan. Anda dapat memilih mode yang berbeda sesuai kebutuhan.
            </p>
          </div>

          <div style="display: flex; gap: 12px;">
            <button onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 16px; background: #6b7280; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: all 0.3s;"
                    onmouseover="this.style.background='#4b5563'"
                    onmouseout="this.style.background='#6b7280'">
              ‚ùå Batal
            </button>
            <button onclick="changeMode(); document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 16px; background: ${accentColor}; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: all 0.3s;"
                    onmouseover="this.style.transform='scale(1.02)'"
                    onmouseout="this.style.transform='scale(1)'">
              ‚úÖ Ya, Ganti Mode
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function changeMode() {
      // Reset mode settings
      userMode = null;
      activeClass = null;
      availableClasses = [];
      
      // Hapus dari localStorage
      localStorage.removeItem('userMode');
      localStorage.removeItem('activeClass');
      localStorage.removeItem('availableClasses');
      
      // Stop auto save
      stopAutoSave();
      
      // Kembali ke mode selection
      showModeSelection();
      showMiniNotification('üîÑ Silakan pilih mode baru', 'info');
    }

    function confirmRestore(backupData) {
      currentData = backupData.data;
      
      // Restore mode settings jika ada
      if (backupData.mode) {
        userMode = backupData.mode;
      }
      if (backupData.activeClass) {
        activeClass = backupData.activeClass;
      }
      if (backupData.availableClasses) {
        availableClasses = backupData.availableClasses;
      }

      saveToLocalStorage();
      saveModeSettings();
      renderApp();
      showMiniNotification('‚úÖ Data berhasil di-restore!', 'success');
    }

    function showMiniNotification(message, type = 'success') {
      const colors = {
        success: { bg: '#10b981', icon: '‚úÖ' },
        warning: { bg: '#f59e0b', icon: '‚ö†Ô∏è' },
        error: { bg: '#ef4444', icon: '' },
        info: { bg: '#3b82f6', icon: '‚ÑπÔ∏è' }
      };

      const color = colors[type] || colors.info;

      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 80px;
        right: 20px;
        background: ${color.bg};
        color: white;
        padding: 12px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 9998;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        font-weight: 600;
        animation: slideInUp 0.3s ease-out;
        max-width: 300px;
      `;

      notification.innerHTML = `
        <span style="font-size: 16px;">${color.icon}</span>
        <span>${message}</span>
      `;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'slideOutDown 0.3s ease-in forwards';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    function showToastNotification(message, icon = '‚úÖ', duration = 3000) {
      const toast = document.createElement('div');
      toast.className = 'toast-notification';
      toast.innerHTML = `
        <div class="checkmark-circle">
          <div class="checkmark"></div>
        </div>
        <div>
          <div style="font-weight: bold; font-size: 16px; margin-bottom: 3px;">Berhasil Disimpan!</div>
          <div style="font-size: 13px; opacity: 0.9;">${message}</div>
        </div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('hiding');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 400);
      }, duration);
    }

    function showAutoSaveIndicator() {
      const indicator = document.getElementById('autoSaveIndicator');
      if (!indicator) return;

      if (autoSaveTimeout) {
        clearTimeout(autoSaveTimeout);
      }

      indicator.classList.add('show');

      autoSaveTimeout = setTimeout(() => {
        indicator.classList.remove('show');
      }, 2000);
    }

    async function initApp() {
      loadFromLocalStorage();
      
      // Cek apakah mode sudah dipilih
      if (!userMode) {
        showModeSelection();
      } else {
        startAutoSave();
        renderApp();
      }
    }

    function showModeSelection() {
      const app = document.getElementById('app');
      
      // Tentukan warna berdasarkan tema
      const bgGradient = isDarkTheme 
        ? 'linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%)'
        : 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)';
      
      const cardBg1 = isDarkTheme
        ? 'linear-gradient(135deg, #1e293b 0%, #334155 100%)'
        : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      
      const cardBg2 = isDarkTheme
        ? 'linear-gradient(135deg, #1e293b 0%, #334155 100%)'
        : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
      
      const textColor = isDarkTheme ? '#ffffff' : '#ffffff';
      const cardOverlayBg = isDarkTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255,255,255,0.15)';
      const infoBg = isDarkTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255,255,255,0.15)';
      const borderColor = isDarkTheme ? 'rgba(148, 163, 184, 0.3)' : 'rgba(255,255,255,0.2)';
      
      const buttonBg = isDarkTheme ? '#3b82f6' : 'white';
      const buttonColor1 = isDarkTheme ? 'white' : '#667eea';
      const buttonColor2 = isDarkTheme ? 'white' : '#f5576c';
      
      // Grid pattern color - menyesuaikan tema dan aksen
      const gridColor = isDarkTheme 
        ? `${accentColor}40` 
        : 'rgba(255, 255, 255, 0.25)';
      
      app.innerHTML = `
        <div style="min-height: 100%; width: 100%; background: ${bgGradient}; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;">
          
          <!-- Theme Toggle Button - Posisi Kanan Atas -->
          <div style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
            <div style="background: ${isDarkTheme ? 'rgba(30, 41, 59, 0.9)' : 'rgba(255,255,255,0.25)'}; padding: 12px 20px; border-radius: 50px; backdrop-filter: blur(10px); border: 2px solid ${borderColor}; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
              <div style="display: flex; align-items: center; gap: 12px;">
                <span style="color: ${textColor}; font-size: 13px; font-weight: 600; opacity: 0.9;">Tema:</span>
                <div class="theme-switch ${isDarkTheme ? 'active' : ''}" onclick="toggleModeSelectionTheme()" 
                     style="position: relative; width: 60px; height: 30px; background: ${isDarkTheme ? '#1e293b' : 'rgba(255,255,255,0.3)'}; border-radius: 15px; cursor: pointer; transition: all 0.3s; border: 2px solid ${isDarkTheme ? '#475569' : 'rgba(255,255,255,0.4)'};">
                  <div class="theme-switch-slider" 
                       style="position: absolute; top: 3px; left: ${isDarkTheme ? '33px' : '3px'}; width: 24px; height: 24px; background: ${isDarkTheme ? '#3b82f6' : 'white'}; border-radius: 50%; transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                    ${isDarkTheme ? 'üåô' : '‚òÄÔ∏è'}
                  </div>
                </div>
                <span style="color: ${textColor}; font-size: 13px; font-weight: 600; opacity: 0.9;">${isDarkTheme ? 'Gelap' : 'Terang'}</span>
              </div>
            </div>
          </div>

          <div style="max-width: 1200px; width: 100%; animation: fadeIn 0.5s ease-out;">
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 50px;">
              <h1 style="color: ${textColor}; font-size: clamp(32px, 5vw, 48px); font-weight: bold; margin-bottom: 15px; text-shadow: 0 4px 12px rgba(0,0,0,0.4); letter-spacing: -0.5px;">
                BUKU ADMINISTRASI DIGITAL GURU
              </h1>
              <p style="color: ${textColor}; opacity: 0.95; font-size: clamp(16px, 2.5vw, 20px); line-height: 1.6; max-width: 700px; margin: 0 auto; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                Pilih mode pengguna sesuai dengan peran Anda untuk memulai mengelola data siswa dengan lebih efisien
              </p>
            </div>

            <!-- Mode Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
              <!-- Mode Wali Kelas -->
              <div class="mode-card" onclick="selectMode('wali_kelas')" 
                   style="background: ${cardBg1}; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); border: 3px solid ${borderColor}; animation: bounceIn 0.6s ease-out; position: relative; overflow: hidden;">
                
                <!-- Decorative Elements -->
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(30px);"></div>
                
                <div style="position: relative; z-index: 1;">
                  <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3)); animation: float 3s ease-in-out infinite;"></div>
                    <h2 style="color: ${textColor}; font-size: 28px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                      MODE WALI KELAS
                    </h2>
                    <div style="width: 60px; height: 4px; background: ${isDarkTheme ? '#3b82f6' : 'white'}; margin: 0 auto; border-radius: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>
                  </div>

                  <div style="background: ${cardOverlayBg}; padding: 25px; border-radius: 15px; margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid ${borderColor};">
                    <p style="color: ${textColor}; font-size: 15px; line-height: 1.8; margin-bottom: 20px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">
                      Cocok untuk guru yang menjadi wali kelas dan mengelola <strong>SATU KELAS</strong> secara khusus
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 12px;">
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Fokus pada 1 kelas saja</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Data terkunci pada kelas yang dipilih</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Manajemen siswa lebih terfokus</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Ideal untuk homeroom teacher</span>
                      </div>
                    </div>
                  </div>

                  <button onclick="selectMode('wali_kelas'); event.stopPropagation();" 
                          style="width: 100%; padding: 18px; background: ${buttonBg}; color: ${buttonColor1}; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); transition: all 0.3s;"
                          onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 12px 32px rgba(0,0,0,0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.3)'">
                    üéØ PILIH MODE INI
                  </button>
                </div>
              </div>

              <!-- Mode Guru Mata Pelajaran -->
              <div class="mode-card" onclick="selectMode('guru_mapel')" 
                   style="background: ${cardBg2}; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); border: 3px solid ${borderColor}; animation: bounceIn 0.6s ease-out 0.2s both; position: relative; overflow: hidden;">
                
                <!-- Decorative Elements -->
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(30px);"></div>
                
                <div style="position: relative; z-index: 1;">
                  <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3)); animation: float 3s ease-in-out infinite; animation-delay: 0.5s;"></div>
                    <h2 style="color: ${textColor}; font-size: 28px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                      MODE GURU MATA PELAJARAN
                    </h2>
                    <div style="width: 60px; height: 4px; background: ${isDarkTheme ? '#3b82f6' : 'white'}; margin: 0 auto; border-radius: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>
                  </div>

                  <div style="background: ${cardOverlayBg}; padding: 25px; border-radius: 15px; margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid ${borderColor};">
                    <p style="color: ${textColor}; font-size: 15px; line-height: 1.8; margin-bottom: 20px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">
                      Cocok untuk guru mata pelajaran yang mengajar di <strong>BANYAK KELAS</strong>
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 12px;">
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Kelola banyak kelas sekaligus</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Data terpisah per kelas</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Mudah beralih antar kelas</span>
                      </div>
                      <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="color: #4ade80; font-size: 20px; flex-shrink: 0; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">‚úì</span>
                        <span style="color: ${textColor}; font-size: 14px; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Ideal untuk subject teacher</span>
                      </div>
                    </div>
                  </div>

                  <button onclick="selectMode('guru_mapel'); event.stopPropagation();" 
                          style="width: 100%; padding: 18px; background: ${buttonBg}; color: ${buttonColor2}; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); transition: all 0.3s;"
                          onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 12px 32px rgba(0,0,0,0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.3)'">
                    üéØ PILIH MODE INI
                  </button>
                </div>
              </div>
            </div>

            <style>
              @keyframes shimmer {
                0%, 100% {
                  opacity: 1;
                  transform: scale(1);
                }
                50% {
                  opacity: 0.85;
                  transform: scale(1.02);
                }
              }

              @keyframes pulse {
                0%, 100% {
                  transform: scale(1);
                }
                50% {
                  transform: scale(1.15);
                }
              }
            </style>
          </div>
        </div>
      `;
    }

    function toggleModeSelectionTheme() {
      isDarkTheme = !isDarkTheme;
      showModeSelection();
    }

    function selectMode(mode) {
      userMode = mode;
      saveModeSettings();

      if (mode === 'wali_kelas') {
        // Untuk wali kelas, langsung ke setup kelas
        showClassSetup();
      } else {
        // Untuk guru mapel, langsung ke app dengan class manager
        startAutoSave();
        renderApp();
      }
    }

    function showClassSetup() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <div style="min-height: 100%; width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px;">
          <div style="max-width: 600px; width: 100%; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: bounceIn 0.6s ease-out;">
            <div style="text-align: center; margin-bottom: 35px;">
              <div style="font-size: 80px; margin-bottom: 20px;">üè´</div>
              <h2 style="color: #667eea; font-size: 32px; font-weight: bold; margin-bottom: 10px;">
                Setup Kelas Anda
              </h2>
              <p style="color: #666; font-size: 16px; line-height: 1.6;">
                Masukkan nama kelas yang akan Anda kelola sebagai wali kelas
              </p>
            </div>

            <form id="classSetupForm" onsubmit="handleClassSetup(event)" style="display: grid; gap: 25px;">
              <div>
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333; font-size: 15px;">
                  Nama Kelas <span style="color: #ef4444;">*</span>
                </label>
                <input type="text" name="kelas" required
                       placeholder="Contoh: 7A, 10 IPA 1, XII MIPA 2"
                       style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; transition: all 0.3s;"
                       onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                       onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                <p style="color: #666; font-size: 13px; margin-top: 8px; line-height: 1.5;">
                  üí° Kelas ini akan terkunci dan tidak bisa diubah setelah disimpan
                </p>
              </div>

              <div style="background: #fef3c7; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                <p style="color: #92400e; font-size: 14px; line-height: 1.6; margin: 0;">
                  <strong>‚ö†Ô∏è Perhatian:</strong> Dalam mode Wali Kelas, Anda hanya dapat mengelola satu kelas. Pastikan nama kelas yang Anda masukkan sudah benar.
                </p>
              </div>

              <button type="submit" 
                      style="width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;"
                      onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.5)'"
                      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                ‚úÖ SIMPAN DAN LANJUTKAN
              </button>
            </form>
          </div>
        </div>
      `;
    }

    function handleClassSetup(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const kelas = formData.get('kelas');

      activeClass = kelas;
      availableClasses = [kelas];
      
      saveModeSettings();
      
      // Simpan ke profile guru juga
      const guruData = getGuruData();
      saveData('guru', { 
        ...guruData, 
        kelas: kelas,
        jabatan: 'Wali Kelas',
        id: guruData.id || 'guru-1' 
      });

      startAutoSave();
      renderApp();
      showMiniNotification('‚úÖ Kelas berhasil disetup!', 'success');
    }

    function showClassManager() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        overflow-y: auto;
      `;

      modal.innerHTML = `
        <div style="background: var(--card-bg); padding: 35px; border-radius: 20px; max-width: 700px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: bounceIn 0.5s ease-out;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
              <h3 style="color: var(--text-color); font-size: 28px; font-weight: bold; margin-bottom: 5px;">
                üìö Kelola Kelas
              </h3>
              <p style="color: var(--text-color); opacity: 0.7; font-size: 14px;">
                Mode: <strong>${userMode === 'wali_kelas' ? 'Wali Kelas' : 'Guru Mata Pelajaran'}</strong>
              </p>
            </div>
            <button onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="background: #ef4444; color: white; border: none; border-radius: 10px; padding: 10px 20px; cursor: pointer; font-weight: bold; font-size: 16px;">
              ‚úï
            </button>
          </div>

          ${userMode === 'guru_mapel' ? `
            <!-- Form Tambah Kelas (hanya untuk guru mapel) -->
            <form id="addClassForm" onsubmit="handleAddClass(event)" style="background: var(--bg-color); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid ${accentColor};">
              <h4 style="color: var(--text-color); font-size: 18px; font-weight: bold; margin-bottom: 15px;">
                ‚ûï Tambah Kelas Baru
              </h4>
              <div style="display: flex; gap: 12px;">
                <input type="text" name="new_class" required
                       placeholder="Contoh: 7A, 10 IPA 1"
                       style="flex: 1; padding: 12px; border-radius: 8px; font-size: 14px; border: 2px solid var(--border-color);">
                <button type="submit" 
                        style="padding: 12px 24px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap;">
                  ‚ûï Tambah
                </button>
              </div>
            </form>
          ` : ''}

          <!-- Daftar Kelas -->
          <div style="margin-bottom: 25px;">
            <h4 style="color: var(--text-color); font-size: 18px; font-weight: bold; margin-bottom: 15px;">
              üìã Daftar Kelas ${userMode === 'wali_kelas' ? '(Terkunci)' : ''}
            </h4>
            
            ${availableClasses.length > 0 ? `
              <div style="display: grid; gap: 12px;">
                ${availableClasses.map(kelas => `
                  <div class="class-selector-badge ${kelas === activeClass ? 'active' : ''}"
                       style="background: ${kelas === activeClass ? accentColor : 'var(--bg-color)'}; 
                              color: ${kelas === activeClass ? 'white' : 'var(--text-color)'}; 
                              padding: 18px 20px; 
                              border-radius: 12px; 
                              display: flex; 
                              justify-content: space-between; 
                              align-items: center;
                              border: 2px solid ${kelas === activeClass ? accentColor : 'var(--border-color)'};
                              box-shadow: ${kelas === activeClass ? '0 4px 12px rgba(59, 130, 246, 0.3)' : 'none'};">
                    <div style="display: flex; align-items: center; gap: 15px;">
                      <span style="font-size: 28px;">üè´</span>
                      <div>
                        <p style="font-size: 18px; font-weight: bold; margin-bottom: 3px;">
                          Kelas ${kelas}
                        </p>
                        ${kelas === activeClass ? `
                          <p style="font-size: 12px; opacity: 0.9;">
                            ‚úì Kelas Aktif Saat Ini
                          </p>
                        ` : ''}
                      </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                      ${kelas !== activeClass ? `
                        <button onclick="switchClass('${kelas}'); document.body.removeChild(this.closest('[style*=fixed]'))" 
                                style="padding: 10px 20px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;">
                          üîÑ Aktifkan
                        </button>
                      ` : ''}
                      ${userMode === 'guru_mapel' && availableClasses.length > 1 ? `
                        <button onclick="deleteClass('${kelas}')" 
                                style="padding: 10px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;">
                          üóëÔ∏è
                        </button>
                      ` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
            ` : `
              <div style="background: var(--bg-color); padding: 40px; border-radius: 12px; text-align: center; border: 2px dashed var(--border-color);">
                <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                  Belum ada kelas. Tambahkan kelas baru di atas.
                </p>
              </div>
            `}
          </div>

          ${userMode === 'wali_kelas' ? `
            <div style="background: #e0f2fe; padding: 20px; border-radius: 12px; border-left: 4px solid #0284c7;">
              <p style="color: #0c4a6e; font-size: 14px; line-height: 1.6; margin: 0;">
                <strong>‚ÑπÔ∏è Info:</strong> Dalam mode Wali Kelas, kelas Anda terkunci dan tidak dapat diubah atau dihapus. Untuk mengelola banyak kelas, gunakan Mode Guru Mata Pelajaran.
              </p>
            </div>
          ` : `
            <div style="background: #fef3c7; padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
              <p style="color: #92400e; font-size: 14px; line-height: 1.6; margin: 0;">
                <strong>üí° Tips:</strong> Setiap kelas memiliki data siswa, nilai, dan absen yang terpisah. Pastikan Anda mengaktifkan kelas yang tepat sebelum mengelola data.
              </p>
            </div>
          `}
        </div>
      `;

      document.body.appendChild(modal);
    }

    function handleAddClass(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const newClass = formData.get('new_class').trim();

      if (!newClass) {
        showMiniNotification('‚ö†Ô∏è Nama kelas tidak boleh kosong', 'warning');
        return;
      }

      if (availableClasses.includes(newClass)) {
        showMiniNotification('‚ö†Ô∏è Kelas sudah ada', 'warning');
        return;
      }

      availableClasses.push(newClass);
      saveModeSettings();
      
      event.target.reset();
      showMiniNotification('‚úÖ Kelas berhasil ditambahkan!', 'success');
      
      // Refresh modal
      document.body.removeChild(event.target.closest('[style*="position: fixed"]'));
      showClassManager();
    }

    function switchClass(kelas) {
      activeClass = kelas;
      saveModeSettings();
      renderApp();
      showMiniNotification(`‚úÖ Beralih ke Kelas ${kelas}`, 'success');
    }

    function deleteClass(kelas) {
      if (kelas === activeClass) {
        showMiniNotification('‚ö†Ô∏è Tidak dapat menghapus kelas yang sedang aktif', 'warning');
        return;
      }

      const confirmModal = document.createElement('div');
      confirmModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        padding: 20px;
      `;

      confirmModal.innerHTML = `
        <div style="background: var(--card-bg); padding: 30px; border-radius: 15px; max-width: 450px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
          <div style="text-align: center; margin-bottom: 25px;">
            <div style="font-size: 64px; margin-bottom: 15px;">‚ö†Ô∏è</div>
            <h3 style="color: var(--text-color); font-size: 24px; font-weight: bold; margin-bottom: 10px;">
              Hapus Kelas ${kelas}?
            </h3>
            <p style="color: var(--text-color); opacity: 0.8; line-height: 1.6;">
              Semua data siswa, nilai, dan absen untuk kelas ini akan dihapus permanen.
            </p>
          </div>

          <div style="display: flex; gap: 12px;">
            <button onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 14px; background: #6b7280; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
              Batal
            </button>
            <button onclick="confirmDeleteClass('${kelas}'); document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="flex: 1; padding: 14px; background: #ef4444; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
              Ya, Hapus
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(confirmModal);
    }

    function confirmDeleteClass(kelas) {
      // Hapus kelas dari array
      availableClasses = availableClasses.filter(k => k !== kelas);
      
      // Hapus semua data yang terkait dengan kelas ini
      currentData = currentData.filter(item => {
        if (item.type === 'siswa' || item.type === 'nilai_detail' || item.type === 'absen') {
          return item.kelas_id !== kelas;
        }
        return true;
      });

      saveModeSettings();
      saveToLocalStorage();
      
      showMiniNotification(`‚úÖ Kelas ${kelas} berhasil dihapus`, 'success');
      
      // Refresh modal
      const modals = document.querySelectorAll('[style*="position: fixed"]');
      modals.forEach(modal => {
        if (modal.parentNode) {
          document.body.removeChild(modal);
        }
      });
      showClassManager();
    }

    function getGuruData() {
      return currentData.find(d => d.type === 'guru') || {};
    }

    function getVisiMisi() {
      return currentData.find(d => d.type === 'visi_misi') || {};
    }

    function getMapelList() {
      return currentData.filter(d => d.type === 'mapel');
    }

    function getSiswaList() {
      // Filter berdasarkan kelas aktif
      return currentData.filter(d => d.type === 'siswa' && d.kelas_id === activeClass);
    }

    function getNilaiList() {
      return currentData.filter(d => d.type === 'nilai');
    }

    function getAbsenList() {
      // Filter berdasarkan kelas aktif
      return currentData.filter(d => d.type === 'absen' && d.kelas_id === activeClass);
    }

    function getCatatanList() {
      return currentData.filter(d => d.type === 'catatan');
    }

    function getRPPList() {
      return currentData.filter(d => d.type === 'rpp');
    }

    function getKolomPenilaianList() {
      return currentData.filter(d => d.type === 'kolom_penilaian');
    }

    function getNilaiDetailList() {
      // Filter berdasarkan kelas aktif
      return currentData.filter(d => d.type === 'nilai_detail' && d.kelas_id === activeClass);
    }

    function getCatatanSiswaList() {
      return currentData.filter(d => d.type === 'catatan_siswa');
    }

    function updateThemeColors() {
      const root = document.documentElement;
      
      if (isDarkTheme) {
        root.style.setProperty('--bg-color', '#000000');
        root.style.setProperty('--text-color', '#ffffff');
        root.style.setProperty('--card-bg', '#1a1a1a');
        root.style.setProperty('--input-bg', '#2a2a2a');
        root.style.setProperty('--border-color', '#404040');
        root.style.setProperty('--placeholder-color', '#888888');
        root.style.setProperty('--grid-color', accentColor + '20');
        root.style.setProperty('--switch-bg', '#2a2a2a');
        root.style.setProperty('--card-start', accentColor + '40');
        root.style.setProperty('--card-end', accentColor + '20');
      } else {
        root.style.setProperty('--bg-color', '#ffffff');
        root.style.setProperty('--text-color', '#000000');
        root.style.setProperty('--card-bg', '#f8f9fa');
        root.style.setProperty('--input-bg', '#ffffff');
        root.style.setProperty('--border-color', '#e0e0e0');
        root.style.setProperty('--placeholder-color', '#999999');
        root.style.setProperty('--grid-color', accentColor + '30');
        root.style.setProperty('--switch-bg', '#e0e0e0');
        root.style.setProperty('--card-start', accentColor + '30');
        root.style.setProperty('--card-end', accentColor + '10');
      }
      
      root.style.setProperty('--accent-color', accentColor);
    }

    function toggleMobileMenu() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.mobile-overlay');
      
      if (sidebar && overlay) {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      }
    }

    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      updateThemeColors();
      renderApp();
    }

    function changeAccentColor(color) {
      accentColor = color;
      updateThemeColors();
      renderApp();
    }

    function showColorPicker() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      `;

      modal.innerHTML = `
        <div style="background: var(--card-bg); padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
          <h3 style="color: var(--text-color); font-size: 24px; font-weight: bold; margin-bottom: 20px;">Pilih Warna Aksen</h3>
          
          <div style="margin-bottom: 25px;">
            <label style="color: var(--text-color); display: block; margin-bottom: 10px; font-weight: 600;">Pilih Manual:</label>
            <input type="color" id="customColorPicker" value="${accentColor}" style="width: 100%; height: 50px; border-radius: 8px; cursor: pointer;">
          </div>

          <div style="margin-bottom: 25px;">
            <label style="color: var(--text-color); display: block; margin-bottom: 10px; font-weight: 600;">Pilihan Warna:</label>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
              ${accentPresets.map(preset => `
                <div class="color-picker-option ${preset.color === accentColor ? 'active' : ''}" 
                     style="background: ${preset.color};" 
                     onclick="changeAccentColor('${preset.color}'); document.body.removeChild(this.closest('[style*=fixed]'));"
                     title="${preset.name}">
                </div>
              `).join('')}
            </div>
          </div>

          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Batal
            </button>
            <button onclick="changeAccentColor(document.getElementById('customColorPicker').value); document.body.removeChild(this.closest('[style*=fixed]'))" 
                    style="padding: 10px 20px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Terapkan
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    async function saveData(type, data, showNotification = false) {
      // Tambahkan kelas_id untuk data yang perlu difilter per kelas
      if (['siswa', 'nilai_detail', 'absen'].includes(type)) {
        data.kelas_id = activeClass;
      }

      const existingIndex = currentData.findIndex(d => d.type === type && d.id === data.id);
      
      if (existingIndex !== -1) {
        currentData[existingIndex] = { ...currentData[existingIndex], ...data };
      } else {
        currentData.push({ ...data, type, id: data.id || Date.now().toString() });
      }

      saveToLocalStorage();
      
      if (showNotification) {
        showToastNotification('Data telah tersimpan secara otomatis');
      }
      
      renderApp();
    }

    async function deleteData(item) {
      const index = currentData.findIndex(d => d.id === item.id && d.type === item.type);
      if (index !== -1) {
        currentData.splice(index, 1);
        saveToLocalStorage();
        renderApp();
      }
    }

    function renderApp() {
      const guruData = getGuruData();
      const namaGuru = guruData.nama_guru || 'Nama Guru';
      const namaSekolah = guruData.nama_sekolah || 'Nama Sekolah';
      const kelas = activeClass || guruData.kelas || 'Kelas';

      const app = document.getElementById('app');
      app.innerHTML = `
        <div class="h-full w-full grid-pattern" style="background-color: var(--bg-color);">
          <!-- Header -->
          <header style="background: var(--card-bg); border-bottom: 2px solid var(--accent-color); padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="max-width: 1400px; margin: 0 auto;">
              <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                <!-- Left Section -->
                <div style="display: flex; align-items: center; gap: 15px; flex: 1; min-width: 0;">
                  <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
                  <div style="flex: 1; min-width: 0;">
                    <h1 class="gradient-text" style="font-size: clamp(16px, 3vw, 20px); font-weight: bold; margin: 0 0 8px 0; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      ${guruData.nama_aplikasi || window.elementSdk?.config?.app_title || defaultConfig.app_title} : ${namaGuru}
                    </h1>
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                      <p style="color: var(--text-color); opacity: 0.7; font-size: clamp(12px, 1.8vw, 14px); font-style: italic; margin: 0; white-space: nowrap;">
                        ${namaSekolah} | Kelas ${kelas}
                      </p>
                      ${userMode === 'guru_mapel' ? `
                        <button onclick="showClassManager()" 
                                style="padding: 6px 12px; background: ${accentColor}; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 5px;">
                          üîÑ Kelola Kelas
                        </button>
                      ` : ''}
                      <div style="padding: 6px 14px; border: 2px solid ${accentColor}; border-radius: 8px; background: rgba(${parseInt(accentColor.slice(1,3), 16)}, ${parseInt(accentColor.slice(3,5), 16)}, ${parseInt(accentColor.slice(5,7), 16)}, 0.1);">
                        <p style="color: ${accentColor}; font-size: clamp(11px, 1.8vw, 13px); font-weight: 600; font-style: italic; margin: 0; white-space: nowrap;">
                           ${guruData.kalimat_motivasi || 'Tetaplah Semangat Mengajar'}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Right Section -->
                <div style="display: flex; gap: 8px; align-items: Right; flex-shrink: 0;">
                  <div style="display: flex; flex-direction: column; align-items: right; gap: 3px;">
                    <div class="theme-switch ${isDarkTheme ? 'active' : ''}" onclick="toggleTheme()">
                      <div class="theme-switch-slider">
                        ${isDarkTheme ? 'üåô' : '‚òÄÔ∏è'}
                      </div>
                    </div>
                    <span style="color: var(--text-color); font-size: 10px; font-weight: 600; white-space: nowrap;">
                      ${isDarkTheme ? 'Gelap' : 'Terang'}
                    </span>
                  </div>

                  <button onclick="showColorPicker()" 
                          style="padding: 10px 14px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                    <span style="width: 18px; height: 18px; background: ${accentColor}; border: 2px solid white; border-radius: 4px;"></span>
                    <span class="hide-on-small">Warna</span>
                  </button>

                  <button onclick="manualSave()" 
                          style="padding: 10px 14px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                    üíæ <span class="hide-on-small">Simpan</span>
                  </button>

                  <button onclick="backupData()" 
                          style="padding: 10px 14px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                    üì• <span class="hide-on-small">Backup</span>
                  </button>

                  <button onclick="restoreData()" 
                          style="padding: 10px 14px; background: #8b5cf6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                    üì§ <span class="hide-on-small">Restore</span>
                  </button>

                  <button onclick="showChangeModeConfirmation()" 
                          style="padding: 10px 14px; background: #f59e0b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                    üîÑ <span class="hide-on-small">Ganti Mode</span>
                  </button>

                  <div class="hide-on-small" style="display: flex; align-items: center; gap: 6px; padding: 10px 14px; background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; border-radius: 8px;">
                    <div class="pulse-dot" style="background: #10b981;"></div>
                    <span style="color: var(--text-color); font-weight: 600; font-size: 12px; white-space: nowrap;">Auto-Save</span>
                  </div>
                </div>
              </div>
            </div>
          </header>

          <!-- Mobile Overlay -->
          <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>

          <div style="display: flex; height: calc(100% - 100px); overflow: hidden;">
            <!-- Sidebar -->
            <aside class="sidebar" style="width: 280px; background: var(--card-bg); border-right: 2px solid var(--accent-color); overflow-y: auto; padding: 20px;">
              ${renderSidebar()}
            </aside>

            <!-- Main Content -->
            <main style="flex: 1; overflow-y: auto; padding: 30px;">
              <div style="max-width: 1200px; margin: 0 auto;">
                ${renderCurrentMenu()}
              </div>
            </main>
          </div>
        </div>
      `;

      updateThemeColors();
    }

    function renderSidebar() {
      const menus = [
        { id: 'dashboard', icon: 'üìä', label: 'DASHBOARD' },
        { id: 'profile', icon: 'üë§', label: 'PROFILE GURU' },
        { id: 'visi_misi', icon: 'üéØ', label: 'VISI DAN MISI SEKOLAH' },
        { id: 'mapel', icon: 'üìö', label: 'DATA MATA PELAJARAN' },
        { id: 'siswa', icon: 'üë•', label: 'DATA SISWA' },
        { id: 'nilai', icon: 'üìù', label: 'NILAI SISWA' },
        { id: 'absen', icon: '‚úÖ', label: 'ABSEN SISWA' },
        { id: 'hasil', icon: 'üìà', label: 'HASIL BELAJAR SISWA' },
        { id: 'cetak', icon: 'üñ®Ô∏è', label: 'CETAK HASIL BELAJAR' },
        { id: 'rpp', icon: 'üìñ', label: 'RPP/MODUL/VIDEO' },
        { id: 'catatan', icon: 'üìã', label: 'CATATAN GURU' }
      ];

      return menus.map(menu => `
        <div onclick="currentMenu = '${menu.id}'; renderApp(); toggleMobileMenu();" 
             style="padding: 15px; margin-bottom: 10px; background: ${currentMenu === menu.id ? accentColor : 'transparent'}; 
                    color: ${currentMenu === menu.id ? 'white' : 'var(--text-color)'}; 
                    border-radius: 10px; cursor: pointer; font-weight: 600; 
                    transition: all 0.3s; display: flex; align-items: center; gap: 12px;
                    border: 2px solid ${currentMenu === menu.id ? accentColor : 'transparent'};">
          <span style="font-size: 24px;">${menu.icon}</span>
          <span style="font-size: 13px;">${menu.label}</span>
        </div>
      `).join('');
    }

    function renderCurrentMenu() {
      if (isLoading) {
        return `<div style="display: flex; justify-content: center; align-items: center; height: 400px;">
          <div class="loading-spinner"></div>
        </div>`;
      }

      switch(currentMenu) {
        case 'dashboard': return renderDashboard();
        case 'profile': return renderProfile();
        case 'visi_misi': return renderVisiMisi();
        case 'mapel': return renderMapel();
        case 'siswa': return renderSiswa();
        case 'nilai': return renderNilai();
        case 'absen': return renderAbsen();
        case 'hasil': return renderHasil();
        case 'cetak': return renderCetak();
        case 'rpp': return renderRPP();
        case 'catatan': return renderCatatan();
        default: return renderDashboard();
      }
    }

    function renderDashboard() {
      const siswaList = getSiswaList();
      const absenList = getAbsenList();
      const mapelList = getMapelList();
      const nilaiDetailList = getNilaiDetailList();

      const jumlahSiswa = siswaList.length;
      const jumlahLaki = siswaList.filter(s => s.jenis_kelamin === 'Laki-laki').length;
      const jumlahPerempuan = siswaList.filter(s => s.jenis_kelamin === 'Perempuan').length;

      const totalSakit = absenList.filter(a => a.status_absen === 'Sakit').length;
      const totalIzin = absenList.filter(a => a.status_absen === 'Izin').length;
      const totalAlpa = absenList.filter(a => a.status_absen === 'Alpa').length;

      const hasilPerSiswa = siswaList.map(siswa => {
        let grandTotal = 0;
        let grandCount = 0;

        mapelList.forEach(mapel => {
          const nilaiSiswaMapel = nilaiDetailList.filter(n => 
            n.nilai_detail_siswa_id === siswa.id && n.nilai_detail_mapel === mapel.nama_mapel
          );
          
          nilaiSiswaMapel.forEach(n => {
            if (n.nilai_detail_nilai !== null && n.nilai_detail_nilai !== undefined && n.nilai_detail_nilai !== '') {
              grandTotal += parseFloat(n.nilai_detail_nilai);
              grandCount++;
            }
          });
        });

        const rataRata = grandCount > 0 ? (grandTotal / grandCount) : 0;

        return {
          nama: siswa.nama_siswa,
          rataRata: rataRata,
          totalNilai: grandTotal
        };
      });

      const topSiswa = hasilPerSiswa
        .filter(s => s.rataRata > 0)
        .sort((a, b) => b.rataRata - a.rataRata)
        .slice(0, 5);

      return `
        <div style="color: var(--text-color);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
            <h2 style="font-size: 32px; font-weight: bold; margin: 0; color: ${accentColor};">
              üìä DASHBOARD - Kelas ${activeClass}
            </h2>
            ${userMode === 'guru_mapel' && availableClasses.length > 1 ? `
              <div style="background: var(--card-bg); padding: 12px 20px; border-radius: 10px; border: 2px solid ${accentColor};">
                <p style="color: var(--text-color); font-size: 14px; margin: 0;">
                  <strong>Mode:</strong> Guru Mata Pelajaran | <strong>${availableClasses.length}</strong> Kelas Aktif
                </p>
              </div>
            ` : ''}
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
            ${renderStatCard('üë•', 'JUMLAH SISWA', jumlahSiswa, '#3b82f6')}
            ${renderStatCard('üë®‚Äçüéì', 'SISWA LAKI-LAKI', jumlahLaki, '#06b6d4')}
            ${renderStatCard('üë©‚Äçüéì', 'SISWA PEREMPUAN', jumlahPerempuan, '#ec4899')}
            ${renderStatCard('ü§í', 'TOTAL SAKIT', totalSakit, '#f59e0b')}
            ${renderStatCard('üìù', 'TOTAL IZIN', totalIzin, '#8b5cf6')}
            ${renderStatCard('‚ùå', 'TOTAL ALPA', totalAlpa, '#ef4444')}
          </div>

          <div class="card-gradient" style="padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
              üèÜ TOP 5 SISWA DENGAN NILAI TERTINGGI
            </h3>
            ${topSiswa.length > 0 ? `
              <div style="display: flex; flex-direction: column; gap: 15px;">
                ${topSiswa.map((siswa, index) => {
                  let medalIcon = '';
                  let medalColor = '';
                  
                  if (index === 0) {
                    medalIcon = 'ü•á';
                    medalColor = '#FFD700';
                  } else if (index === 1) {
                    medalIcon = 'ü•à';
                    medalColor = '#C0C0C0';
                  } else if (index === 2) {
                    medalIcon = 'ü•â';
                    medalColor = '#CD7F32';
                  } else {
                    medalIcon = `#${index + 1}`;
                    medalColor = accentColor;
                  }

                  return `
                    <div style="background: var(--card-bg); padding: 15px 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid ${medalColor};">
                      <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 28px; min-width: 40px; text-align: center;">${medalIcon}</span>
                        <span style="font-size: 16px; font-weight: 600; color: var(--text-color);">${siswa.nama}</span>
                      </div>
                      <div style="text-align: right;">
                        <span style="font-size: 20px; font-weight: bold; color: ${accentColor};">${siswa.rataRata.toFixed(2)}</span>
                        <span style="font-size: 12px; color: var(--text-color); opacity: 0.7; display: block;">Rata-rata</span>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            ` : `
              <p style="color: var(--text-color); opacity: 0.7; text-align: center; padding: 20px;">
                Belum ada data nilai siswa
              </p>
            `}
          </div>

          
        </div>
      `;
    }

    function renderStatCard(icon, label, value, color) {
      return `
        <div class="stat-card card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 5px solid ${color};">
          <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
            <span style="font-size: 36px;">${icon}</span>
            <div>
              <p style="color: var(--text-color); opacity: 0.8; font-size: 13px; font-weight: 600; margin-bottom: 5px;">
                ${label}
              </p>
              <p style="color: var(--text-color); font-size: 32px; font-weight: bold;">
                ${value}
              </p>
            </div>
          </div>
        </div>
      `;
    }

    // Fungsi render lainnya tetap sama, hanya perlu memastikan data difilter berdasarkan activeClass
    // Saya akan lanjutkan dengan fungsi-fungsi penting lainnya...

    function renderProfile() {
      const guruData = getGuruData();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üë§ PROFILE GURU
          </h2>

          ${userMode === 'wali_kelas' ? `
            <div style="background: #e0f2fe; padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 4px solid #0284c7;">
              <p style="color: #0c4a6e; font-size: 14px; line-height: 1.6; margin: 0;">
                <strong>‚ÑπÔ∏è Mode Wali Kelas:</strong> Anda terkunci pada Kelas <strong>${activeClass}</strong>. Data kelas tidak dapat diubah dalam mode ini.
              </p>
            </div>
          ` : ''}

          <form id="profileForm" onsubmit="handleProfileSubmit(event)" class="card-gradient" style="padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
              ${renderInput('nama_aplikasi', 'Nama Aplikasi', guruData.nama_aplikasi || 'BUKU ADMINISTRASI DIGITAL GURU', 'text', true)}
              ${renderInput('kalimat_motivasi', 'Kalimat Motivasi', guruData.kalimat_motivasi || 'Tetaplah Semangat Mengajar', 'text', true)}
              ${renderInput('nama_guru', 'Nama Guru', guruData.nama_guru || '', 'text', true)}
              ${renderInput('nama_sekolah', 'Nama Sekolah', guruData.nama_sekolah || '', 'text', true)}
              
              ${userMode === 'wali_kelas' ? `
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                    Kelas <span style="color: #ef4444;">*</span> <span style="color: #0284c7; font-size: 12px;">(Terkunci)</span>
                  </label>
                  <input type="text" name="kelas" value="${activeClass}" readonly
                         style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px; background: var(--bg-color); opacity: 0.7; cursor: not-allowed;">
                </div>
              ` : renderInput('kelas', 'Kelas (Opsional)', guruData.kelas || '', 'text', false)}
              
              ${renderInput('tempat_lahir', 'Tempat Lahir', guruData.tempat_lahir || '')}
              ${renderInput('tanggal_lahir', 'Tanggal Lahir', guruData.tanggal_lahir || '', 'date')}
              ${renderInput('nip', 'NIP', guruData.nip || '')}
              ${renderInput('alamat', 'Alamat', guruData.alamat || '')}
              ${renderInput('no_whatsapp', 'No WhatsApp', guruData.no_whatsapp || '', 'tel')}
              ${renderInput('email', 'Email Aktif (belajar.id)', guruData.email || '', 'email')}
              
              ${userMode === 'wali_kelas' ? `
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                    Jabatan <span style="color: #ef4444;">*</span> <span style="color: #0284c7; font-size: 12px;">(Terkunci)</span>
                  </label>
                  <input type="text" name="jabatan" value="Wali Kelas" readonly
                         style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px; background: var(--bg-color); opacity: 0.7; cursor: not-allowed;">
                </div>
              ` : renderInput('jabatan', 'Wali Kelas / Guru Mata Pelajaran', guruData.jabatan || '')}
              
              ${renderInput('tahun_mengajar', 'Mulai Mengajar (Tahun)', guruData.tahun_mengajar || '', 'number')}
              ${renderInput('motto', 'Motto', guruData.motto || '')}
            </div>

            <button type="submit" style="margin-top: 25px; padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%;">
              üíæ SIMPAN PROFILE
            </button>
          </form>
        </div>
      `;
    }

    function renderInput(name, label, value = '', type = 'text', required = false) {
      return `
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
            ${label} ${required ? '<span style="color: #ef4444;">*</span>' : ''}
          </label>
          <input type="${type}" name="${name}" value="${value}" ${required ? 'required' : ''}
                 style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
        </div>
      `;
    }

    function renderTextarea(name, label, value = '', required = false) {
      return `
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
            ${label} ${required ? '<span style="color: #ef4444;">*</span>' : ''}
          </label>
          <textarea name="${name}" rows="4" ${required ? 'required' : ''}
                    style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px; resize: vertical;">${value}</textarea>
        </div>
      `;
    }

    async function handleProfileSubmit(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      // Untuk wali kelas, pastikan kelas tetap terkunci
      if (userMode === 'wali_kelas') {
        data.kelas = activeClass;
        data.jabatan = 'Wali Kelas';
      }
      
      const guruData = getGuruData();
      await saveData('guru', { ...data, id: guruData.id || 'guru-1' }, true);
    }

    // Fungsi render menu lainnya (visi_misi, mapel, siswa, dll) tetap sama
    // Hanya perlu memastikan data siswa, nilai, dan absen difilter berdasarkan activeClass
    // yang sudah ditangani di fungsi getSiswaList(), getNilaiDetailList(), dan getAbsenList()

    // Saya akan tambahkan beberapa fungsi render penting lainnya...

    function renderVisiMisi() {
      const visiMisi = getVisiMisi();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üéØ VISI DAN MISI SEKOLAH
          </h2>

          <form id="visiMisiForm" onsubmit="handleVisiMisiSubmit(event)" style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 15px; color: var(--text-color);">
                üëÅÔ∏è VISI
              </h3>
              ${renderTextarea('visi', '', visiMisi.visi || '', true)}
            </div>

            <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 22px; font-weight: bold; margin-bottom: 15px; color: var(--text-color);">
                üéØ MISI
              </h3>
              ${renderTextarea('misi', '', visiMisi.misi || '', true)}
            </div>

            <button type="submit" style="grid-column: 1 / -1; padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px;">
              üíæ SIMPAN VISI DAN MISI
            </button>
          </form>
        </div>
      `;
    }

    async function handleVisiMisiSubmit(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      const visiMisi = getVisiMisi();
      await saveData('visi_misi', { ...data, id: visiMisi.id || 'visi-misi-1' }, true);
    }

    function renderMapel() {
      const mapelList = getMapelList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üìö DATA MATA PELAJARAN
          </h2>

          <form id="mapelForm" onsubmit="handleMapelSubmit(event)" class="card-gradient" style="padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="display: flex; gap: 15px; align-items: flex-end;">
              ${renderInput('nama_mapel', 'Nama Mata Pelajaran', '', 'text', true)}
              <button type="submit" style="padding: 12px 25px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap;">
                ‚ûï TAMBAH
              </button>
            </div>
          </form>

          <div style="display: grid; gap: 15px;">
            ${mapelList.length > 0 ? mapelList.map(mapel => `
              <div class="card-gradient" style="padding: 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px;">
                  <span style="font-size: 28px;">üìñ</span>
                  <span style="font-size: 18px; font-weight: 600; color: var(--text-color);">${mapel.nama_mapel}</span>
                </div>
                <button onclick="deleteMapel('${mapel.id}')" 
                        style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  üóëÔ∏è Hapus
                </button>
              </div>
            `).join('') : `
              <div class="card-gradient" style="padding: 40px; border-radius: 10px; text-align: center;">
                <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                  Belum ada mata pelajaran. Tambahkan mata pelajaran baru di atas.
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    async function handleMapelSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('mapel', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
    }

    async function deleteMapel(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'mapel');
      if (record) {
        await deleteData(record);
      }
    }

    function renderSiswa() {
      const siswaList = getSiswaList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üë• DATA SISWA - Kelas ${activeClass}
          </h2>

          <form id="siswaForm" onsubmit="handleSiswaSubmit(event)" class="card-gradient" style="padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
              ${renderInput('nama_siswa', 'Nama Siswa', '', 'text', true)}
              ${renderInput('nisn', 'NISN', '')}
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                  Jenis Kelamin <span style="color: #ef4444;">*</span>
                </label>
                <select name="jenis_kelamin" required style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                  <option value="">Pilih Jenis Kelamin</option>
                  <option value="Laki-laki">Laki-laki</option>
                  <option value="Perempuan">Perempuan</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                  Agama
                </label>
                <select name="agama" style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                  <option value="">Pilih Agama</option>
                  <option value="Islam">Islam</option>
                  <option value="Kristen">Kristen</option>
                  <option value="Katolik">Katolik</option>
                  <option value="Hindu">Hindu</option>
                  <option value="Buddha">Buddha</option>
                  <option value="Konghucu">Konghucu</option>
                </select>
              </div>
              ${renderInput('nama_ayah', 'Nama Ayah', '')}
              ${renderInput('nama_ibu', 'Nama Ibu', '')}
              ${renderInput('kontak_orangtua', 'Kontak Orangtua', '', 'tel')}
            </div>

            <button type="submit" style="margin-top: 25px; padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%;">
              ‚ûï TAMBAH SISWA
            </button>
          </form>

          <div style="display: grid; gap: 15px;">
            ${siswaList.length > 0 ? siswaList.map(siswa => `
              <div class="card-gradient" style="padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                  <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 36px;">${siswa.jenis_kelamin === 'Laki-laki' ? 'üë®‚Äçüéì' : 'üë©‚Äçüéì'}</span>
                    <div>
                      <h3 style="font-size: 20px; font-weight: bold; color: var(--text-color); margin-bottom: 5px;">
                        ${siswa.nama_siswa}
                      </h3>
                      <p style="color: var(--text-color); opacity: 0.7; font-size: 14px;">
                        NISN: ${siswa.nisn || '-'}
                      </p>
                    </div>
                  </div>
                  <button onclick="deleteSiswa('${siswa.id}')" 
                          style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
                    üóëÔ∏è Hapus
                  </button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 14px;">
                  <p style="color: var(--text-color);"><strong>Jenis Kelamin:</strong> ${siswa.jenis_kelamin}</p>
                  <p style="color: var(--text-color);"><strong>Agama:</strong> ${siswa.agama || '-'}</p>
                  <p style="color: var(--text-color);"><strong>Nama Ayah:</strong> ${siswa.nama_ayah || '-'}</p>
                  <p style="color: var(--text-color);"><strong>Nama Ibu:</strong> ${siswa.nama_ibu || '-'}</p>
                  <p style="color: var(--text-color);"><strong>Kontak Orangtua:</strong> ${siswa.kontak_orangtua || '-'}</p>
                </div>
              </div>
            `).join('') : `
              <div class="card-gradient" style="padding: 40px; border-radius: 10px; text-align: center;">
                <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                  Belum ada data siswa untuk Kelas ${activeClass}. Tambahkan siswa baru di atas.
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    async function handleSiswaSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('siswa', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
    }

    async function deleteSiswa(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'siswa');
      if (record) {
        await deleteData(record);
      }
    }

    // Fungsi render lainnya (nilai, absen, hasil, rpp, catatan) akan mengikuti pola yang sama
    // dengan memastikan data difilter berdasarkan activeClass

    // Placeholder untuk fungsi render lainnya
    function renderNilai() {
      const mapelList = getMapelList();
      const kolomList = getKolomPenilaianList();
      const siswaList = getSiswaList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üìù NILAI SISWA - Kelas ${activeClass}
          </h2>

          <!-- Form Tambah Kolom Penilaian -->
          <form id="kolomForm" onsubmit="handleKolomSubmit(event)" class="card-gradient" style="padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
              ‚ûï Tambah Kolom Penilaian
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: flex-end;">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                  Mata Pelajaran <span style="color: #ef4444;">*</span>
                </label>
                <select name="kolom_mapel" required style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                  <option value="">Pilih Mata Pelajaran</option>
                  ${mapelList.map(m => `<option value="${m.nama_mapel}">${m.nama_mapel}</option>`).join('')}
                </select>
              </div>
              ${renderInput('kolom_nama', 'Nama Kolom (UH1, UTS, dll)', '', 'text', true)}
              <button type="submit" style="padding: 12px 25px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap;">
                ‚ûï TAMBAH KOLOM
              </button>
            </div>
          </form>

          <!-- Daftar Kolom Penilaian -->
          ${kolomList.length > 0 ? `
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                üìã Daftar Kolom Penilaian
              </h3>
              <div style="display: grid; gap: 12px;">
                ${kolomList.map(kolom => `
                  <div style="background: var(--bg-color); padding: 15px 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid ${accentColor};">
                    <div>
                      <span style="font-weight: bold; color: var(--text-color); font-size: 16px;">${kolom.kolom_mapel}</span>
                      <span style="color: var(--text-color); opacity: 0.7; margin-left: 10px;">‚Üí ${kolom.kolom_nama}</span>
                    </div>
                    <button onclick="deleteKolom('${kolom.id}')" 
                            style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;">
                      üóëÔ∏è Hapus
                    </button>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}

          <!-- Input Nilai Siswa -->
          ${siswaList.length > 0 && kolomList.length > 0 ? `
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                ‚úçÔ∏è Input Nilai Siswa
              </h3>
              ${renderNilaiTable()}
            </div>
          ` : `
            <div class="card-gradient" style="padding: 40px; border-radius: 15px; text-align: center;">
              <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                ${siswaList.length === 0 ? 'Tambahkan data siswa terlebih dahulu.' : 'Tambahkan kolom penilaian terlebih dahulu.'}
              </p>
            </div>
          `}
        </div>
      `;
    }

    function renderNilaiTable() {
      const siswaList = getSiswaList();
      const kolomList = getKolomPenilaianList();
      const nilaiDetailList = getNilaiDetailList();

      // Group kolom by mapel
      const kolomByMapel = {};
      kolomList.forEach(kolom => {
        if (!kolomByMapel[kolom.kolom_mapel]) {
          kolomByMapel[kolom.kolom_mapel] = [];
        }
        kolomByMapel[kolom.kolom_mapel].push(kolom);
      });

      return Object.keys(kolomByMapel).map(mapel => `
        <div style="margin-bottom: 30px;">
          <h4 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: ${accentColor}; padding: 12px; background: var(--bg-color); border-radius: 8px;">
            üìö ${mapel}
          </h4>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
              <thead>
                <tr style="background: ${accentColor}; color: white;">
                  <th style="padding: 12px; text-align: left; border: 1px solid rgba(255,255,255,0.2);">No</th>
                  <th style="padding: 12px; text-align: left; border: 1px solid rgba(255,255,255,0.2);">Nama Siswa</th>
                  ${kolomByMapel[mapel].map(kolom => `
                    <th style="padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">${kolom.kolom_nama}</th>
                  `).join('')}
                </tr>
              </thead>
              <tbody>
                ${siswaList.map((siswa, index) => `
                  <tr style="background: ${index % 2 === 0 ? 'var(--bg-color)' : 'var(--card-bg)'};">
                    <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color);">${index + 1}</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color); font-weight: 600;">${siswa.nama_siswa}</td>
                    ${kolomByMapel[mapel].map(kolom => {
                      const nilaiDetail = nilaiDetailList.find(n => 
                        n.nilai_detail_siswa_id === siswa.id && 
                        n.nilai_detail_kolom_id === kolom.id
                      );
                      const nilaiValue = nilaiDetail ? nilaiDetail.nilai_detail_nilai : '';
                      
                      return `
                        <td style="padding: 8px; border: 1px solid var(--border-color);">
                          <input type="number" 
                                 value="${nilaiValue}" 
                                 onchange="saveNilaiDetail('${siswa.id}', '${kolom.id}', '${mapel}', this.value)"
                                 min="0" max="100" step="0.01"
                                 placeholder="0-100"
                                 style="width: 100%; padding: 8px; border-radius: 6px; text-align: center; font-size: 14px; font-weight: bold;">
                        </td>
                      `;
                    }).join('')}
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `).join('');
    }

    async function handleKolomSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('kolom_penilaian', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
    }

    async function deleteKolom(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'kolom_penilaian');
      if (record) {
        // Hapus juga semua nilai detail yang terkait
        currentData = currentData.filter(d => !(d.type === 'nilai_detail' && d.nilai_detail_kolom_id === itemId));
        await deleteData(record);
      }
    }

    async function saveNilaiDetail(siswaId, kolomId, mapel, nilai) {
      const existingNilai = getNilaiDetailList().find(n => 
        n.nilai_detail_siswa_id === siswaId && 
        n.nilai_detail_kolom_id === kolomId
      );

      const nilaiData = {
        nilai_detail_siswa_id: siswaId,
        nilai_detail_kolom_id: kolomId,
        nilai_detail_mapel: mapel,
        nilai_detail_nilai: nilai === '' ? null : parseFloat(nilai),
        id: existingNilai ? existingNilai.id : Date.now().toString()
      };

      await saveData('nilai_detail', nilaiData);
    }

    // State untuk absen kalender
    let currentAbsenMonth = new Date().getMonth();
    let currentAbsenYear = new Date().getFullYear();

    function renderAbsen() {
      const siswaList = getSiswaList();
      const absenList = getAbsenList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            ‚úÖ ABSEN SISWA - Kelas ${activeClass}
          </h2>

          ${siswaList.length > 0 ? `
            <!-- Kontrol Bulan dan Tahun -->
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                  <button onclick="changeAbsenMonth(-1)" 
                          style="padding: 12px 20px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">
                    ‚óÄ Bulan Sebelumnya
                  </button>
                  <button onclick="changeAbsenMonth(1)" 
                          style="padding: 12px 20px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">
                    Bulan Berikutnya ‚ñ∂
                  </button>
                </div>

                <div style="display: flex; align-items: center; gap: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                      Pilih Bulan:
                    </label>
                    <select id="selectMonth" onchange="setAbsenMonth(parseInt(this.value))" 
                            style="padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; min-width: 150px;">
                      ${['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'].map((bulan, idx) => `
                        <option value="${idx}" ${idx === currentAbsenMonth ? 'selected' : ''}>${bulan}</option>
                      `).join('')}
                    </select>
                  </div>

                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                      Pilih Tahun:
                    </label>
                    <select id="selectYear" onchange="setAbsenYear(parseInt(this.value))" 
                            style="padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; min-width: 120px;">
                      ${[2024, 2025, 2026, 2027, 2028, 2029, 2030, 2031].map(year => `
                        <option value="${year}" ${year === currentAbsenYear ? 'selected' : ''}>${year}</option>
                      `).join('')}
                    </select>
                  </div>

                  <button onclick="goToToday()" 
                          style="padding: 12px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; margin-top: 20px;">
                    üìÖ Hari Ini
                  </button>
                </div>
              </div>

              <div style="text-align: center; margin-top: 20px;">
                <h3 style="font-size: 28px; font-weight: bold; color: ${accentColor};">
                  ${['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'][currentAbsenMonth]} ${currentAbsenYear}
                </h3>
              </div>
            </div>

            <!-- Tabel Absen Kalender -->
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow-x: auto;">
              <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                üìä Kalender Absensi Siswa
              </h3>

              <div style="background: #fef3c7; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
                <p style="color: #92400e; font-size: 13px; line-height: 1.6; margin: 0;">
                  <strong>üí° Cara Pengisian:</strong> Klik pada sel tanggal untuk mengisi status absen siswa. <strong>H</strong> = Hadir, <strong>S</strong> = Sakit, <strong>I</strong> = Izin, <strong>A</strong> = Alpa. Hari Minggu ditandai dengan warna berbeda.
                </p>
              </div>

              ${renderAbsenKalender(siswaList, absenList)}
            </div>

            <!-- Ringkasan Absen -->
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; margin-top: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                üìà Ringkasan Absensi Bulan Ini
              </h3>
              ${renderRingkasanAbsen(siswaList, absenList)}
            </div>
          ` : `
            <div class="card-gradient" style="padding: 40px; border-radius: 15px; text-align: center;">
              <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                Tambahkan data siswa terlebih dahulu untuk mengisi absen.
              </p>
            </div>
          `}
        </div>
      `;
    }

    function renderAbsenKalender(siswaList, absenList) {
      const daysInMonth = new Date(currentAbsenYear, currentAbsenMonth + 1, 0).getDate();
      const firstDay = new Date(currentAbsenYear, currentAbsenMonth, 1).getDay();
      
      const dayNames = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
      
      let html = `
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 11px; min-width: 1200px;">
            <thead>
              <tr style="background: ${accentColor}; color: white;">
                <th style="padding: 12px 8px; border: 2px solid #000; text-align: left; position: sticky; left: 0; background: ${accentColor}; z-index: 10; min-width: 180px; font-size: 12px;">
                  NAMA SISWA
                </th>
      `;

      // Header tanggal
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentAbsenYear, currentAbsenMonth, day);
        const dayOfWeek = date.getDay();
        const isSunday = dayOfWeek === 0;
        
        html += `
          <th style="padding: 8px 4px; border: 2px solid #000; text-align: center; background: ${isSunday ? '#fca5a5' : accentColor}; color: white; min-width: 45px; font-size: 10px; line-height: 1.3;">
            <div style="font-weight: bold; font-size: 11px;">${day}</div>
            <div style="font-size: 9px; opacity: 0.9;">${dayNames[dayOfWeek]}</div>
          </th>
        `;
      }

      html += `
                <th style="padding: 12px 8px; border: 2px solid #000; text-align: center; background: #10b981; color: white; min-width: 50px; font-size: 11px;">H</th>
                <th style="padding: 12px 8px; border: 2px solid #000; text-align: center; background: #f59e0b; color: white; min-width: 50px; font-size: 11px;">S</th>
                <th style="padding: 12px 8px; border: 2px solid #000; text-align: center; background: #3b82f6; color: white; min-width: 50px; font-size: 11px;">I</th>
                <th style="padding: 12px 8px; border: 2px solid #000; text-align: center; background: #ef4444; color: white; min-width: 50px; font-size: 11px;">A</th>
              </tr>
            </thead>
            <tbody>
      `;

      // Baris siswa
      siswaList.forEach((siswa, siswaIndex) => {
        html += `
          <tr style="background: ${siswaIndex % 2 === 0 ? 'var(--bg-color)' : 'var(--card-bg)'};">
            <td style="padding: 10px 8px; border: 2px solid #000; font-weight: 600; color: var(--text-color); position: sticky; left: 0; background: ${siswaIndex % 2 === 0 ? 'var(--bg-color)' : 'var(--card-bg)'}; z-index: 5; font-size: 12px;">
              ${siswa.nama_siswa}
            </td>
        `;

        let countHadir = 0;
        let countSakit = 0;
        let countIzin = 0;
        let countAlpa = 0;

        // Kolom tanggal
        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${currentAbsenYear}-${String(currentAbsenMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const absen = absenList.find(a => 
            a.absen_siswa_id === siswa.id && 
            a.tanggal_absen === dateStr
          );

          const date = new Date(currentAbsenYear, currentAbsenMonth, day);
          const isSunday = date.getDay() === 0;

          let statusText = '';
          let bgColor = isSunday ? '#fee2e2' : 'transparent';
          let textColor = 'var(--text-color)';
          let fontWeight = 'normal';

          if (absen) {
            if (absen.status_absen === 'Hadir') {
              statusText = 'H';
              bgColor = '#d1fae5';
              textColor = '#065f46';
              fontWeight = 'bold';
              countHadir++;
            } else if (absen.status_absen === 'Sakit') {
              statusText = 'S';
              bgColor = '#fed7aa';
              textColor = '#92400e';
              fontWeight = 'bold';
              countSakit++;
            } else if (absen.status_absen === 'Izin') {
              statusText = 'I';
              bgColor = '#bfdbfe';
              textColor = '#1e40af';
              fontWeight = 'bold';
              countIzin++;
            } else if (absen.status_absen === 'Alpa') {
              statusText = 'A';
              bgColor = '#fecaca';
              textColor = '#991b1b';
              fontWeight = 'bold';
              countAlpa++;
            }
          }

          html += `
            <td onclick="openAbsenModal('${siswa.id}', '${siswa.nama_siswa}', '${dateStr}')" 
                style="padding: 8px 4px; border: 2px solid #000; text-align: center; cursor: pointer; background: ${bgColor}; color: ${textColor}; font-weight: ${fontWeight}; font-size: 13px; transition: all 0.2s;"
                onmouseover="this.style.background='${isSunday ? '#fca5a5' : accentColor}20'; this.style.transform='scale(1.1)'"
                onmouseout="this.style.background='${bgColor}'; this.style.transform='scale(1)'">
              ${statusText}
            </td>
          `;
        }

        // Kolom ringkasan
        html += `
            <td style="padding: 10px 8px; border: 2px solid #000; text-align: center; font-weight: bold; background: #d1fae5; color: #065f46; font-size: 13px;">${countHadir}</td>
            <td style="padding: 10px 8px; border: 2px solid #000; text-align: center; font-weight: bold; background: #fed7aa; color: #92400e; font-size: 13px;">${countSakit}</td>
            <td style="padding: 10px 8px; border: 2px solid #000; text-align: center; font-weight: bold; background: #bfdbfe; color: #1e40af; font-size: 13px;">${countIzin}</td>
            <td style="padding: 10px 8px; border: 2px solid #000; text-align: center; font-weight: bold; background: #fecaca; color: #991b1b; font-size: 13px;">${countAlpa}</td>
          </tr>
        `;
      });

      html += `
            </tbody>
          </table>
        </div>
      `;

      return html;
    }

    function renderRingkasanAbsen(siswaList, absenList) {
      let html = `
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
            <thead>
              <tr style="background: ${accentColor}; color: white;">
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: left;">No</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: left;">Nama Siswa</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">Hadir</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">Sakit</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">Izin</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">Alpa</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">Total Hari</th>
                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">% Kehadiran</th>
              </tr>
            </thead>
            <tbody>
      `;

      siswaList.forEach((siswa, index) => {
        const absenSiswa = absenList.filter(a => {
          if (a.absen_siswa_id !== siswa.id) return false;
          const absenDate = new Date(a.tanggal_absen);
          return absenDate.getMonth() === currentAbsenMonth && absenDate.getFullYear() === currentAbsenYear;
        });

        const countHadir = absenSiswa.filter(a => a.status_absen === 'Hadir').length;
        const countSakit = absenSiswa.filter(a => a.status_absen === 'Sakit').length;
        const countIzin = absenSiswa.filter(a => a.status_absen === 'Izin').length;
        const countAlpa = absenSiswa.filter(a => a.status_absen === 'Alpa').length;
        const totalHari = countHadir + countSakit + countIzin + countAlpa;
        const persenKehadiran = totalHari > 0 ? ((countHadir / totalHari) * 100).toFixed(1) : 0;

        html += `
          <tr style="background: ${index % 2 === 0 ? 'var(--bg-color)' : 'var(--card-bg)'};">
            <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color);">${index + 1}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color); font-weight: 600;">${siswa.nama_siswa}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; background: #d1fae5; color: #065f46; font-weight: bold;">${countHadir}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; background: #fed7aa; color: #92400e; font-weight: bold;">${countSakit}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; background: #bfdbfe; color: #1e40af; font-weight: bold;">${countIzin}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; background: #fecaca; color: #991b1b; font-weight: bold;">${countAlpa}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; color: var(--text-color); font-weight: bold;">${totalHari}</td>
            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; color: ${persenKehadiran >= 80 ? '#10b981' : persenKehadiran >= 60 ? '#f59e0b' : '#ef4444'}; font-weight: bold; font-size: 16px;">
              ${persenKehadiran}%
            </td>
          </tr>
        `;
      });

      html += `
            </tbody>
          </table>
        </div>
      `;

      return html;
    }

    function changeAbsenMonth(delta) {
      currentAbsenMonth += delta;
      if (currentAbsenMonth > 11) {
        currentAbsenMonth = 0;
        currentAbsenYear++;
      } else if (currentAbsenMonth < 0) {
        currentAbsenMonth = 11;
        currentAbsenYear--;
      }
      renderApp();
    }

    function setAbsenMonth(month) {
      currentAbsenMonth = month;
      renderApp();
    }

    function setAbsenYear(year) {
      currentAbsenYear = year;
      renderApp();
    }

    function goToToday() {
      const today = new Date();
      currentAbsenMonth = today.getMonth();
      currentAbsenYear = today.getFullYear();
      renderApp();
    }

    function openAbsenModal(siswaId, namaSiswa, tanggal) {
      const absenList = getAbsenList();
      const existingAbsen = absenList.find(a => 
        a.absen_siswa_id === siswaId && a.tanggal_absen === tanggal
      );

      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        animation: fadeIn 0.3s ease-out;
      `;

      const dateObj = new Date(tanggal);
      const formattedDate = dateObj.toLocaleDateString('id-ID', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      modal.innerHTML = `
        <div style="background: var(--card-bg); padding: 35px; border-radius: 20px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: bounceIn 0.5s ease-out;">
          <div style="text-align: center; margin-bottom: 30px;">
            <div style="font-size: 64px; margin-bottom: 15px;">üìù</div>
            <h3 style="color: var(--text-color); font-size: 24px; font-weight: bold; margin-bottom: 10px;">
              Input Absen Siswa
            </h3>
            <div style="background: ${accentColor}20; padding: 15px; border-radius: 10px; border-left: 4px solid ${accentColor};">
              <p style="color: var(--text-color); font-size: 16px; font-weight: 600; margin-bottom: 5px;">
                ${namaSiswa}
              </p>
              <p style="color: var(--text-color); opacity: 0.8; font-size: 14px;">
                ${formattedDate}
              </p>
            </div>
          </div>

          <form id="absenModalForm" onsubmit="handleAbsenModalSubmit(event, '${siswaId}', '${tanggal}', '${existingAbsen ? existingAbsen.id : ''}')">
            <div style="display: grid; gap: 15px; margin-bottom: 25px;">
              <label style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--bg-color); border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='${accentColor}'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)'">
                <input type="radio" name="status_absen" value="Hadir" ${existingAbsen && existingAbsen.status_absen === 'Hadir' ? 'checked' : ''} required
                       style="width: 24px; height: 24px; cursor: pointer;">
                <div style="flex: 1;">
                  <span style="font-size: 24px; margin-right: 10px;">‚úÖ</span>
                  <span style="color: var(--text-color); font-weight: 600; font-size: 16px;">Hadir</span>
                </div>
              </label>

              <label style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--bg-color); border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='${accentColor}'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)'">
                <input type="radio" name="status_absen" value="Sakit" ${existingAbsen && existingAbsen.status_absen === 'Sakit' ? 'checked' : ''}
                       style="width: 24px; height: 24px; cursor: pointer;">
                <div style="flex: 1;">
                  <span style="font-size: 24px; margin-right: 10px;">ü§í</span>
                  <span style="color: var(--text-color); font-weight: 600; font-size: 16px;">Sakit</span>
                </div>
              </label>

              <label style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--bg-color); border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='${accentColor}'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)'">
                <input type="radio" name="status_absen" value="Izin" ${existingAbsen && existingAbsen.status_absen === 'Izin' ? 'checked' : ''}
                       style="width: 24px; height: 24px; cursor: pointer;">
                <div style="flex: 1;">
                  <span style="font-size: 24px; margin-right: 10px;">üìù</span>
                  <span style="color: var(--text-color); font-weight: 600; font-size: 16px;">Izin</span>
                </div>
              </label>

              <label style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--bg-color); border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='${accentColor}'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)'">
                <input type="radio" name="status_absen" value="Alpa" ${existingAbsen && existingAbsen.status_absen === 'Alpa' ? 'checked' : ''}
                       style="width: 24px; height: 24px; cursor: pointer;">
                <div style="flex: 1;">
                  <span style="font-size: 24px; margin-right: 10px;">‚ùå</span>
                  <span style="color: var(--text-color); font-weight: 600; font-size: 16px;">Alpa</span>
                </div>
              </label>
            </div>

            <div style="display: flex; gap: 12px;">
              ${existingAbsen ? `
                <button type="button" onclick="deleteAbsenFromModal('${existingAbsen.id}'); document.body.removeChild(this.closest('[style*=fixed]'))" 
                        style="flex: 1; padding: 16px; background: #ef4444; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px;">
                  üóëÔ∏è Hapus
                </button>
              ` : ''}
              <button type="button" onclick="document.body.removeChild(this.closest('[style*=fixed]'))" 
                      style="flex: 1; padding: 16px; background: #6b7280; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px;">
                ‚ùå Batal
              </button>
              <button type="submit" 
                      style="flex: 1; padding: 16px; background: ${accentColor}; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px;">
                ‚úÖ Simpan
              </button>
            </div>
          </form>
        </div>
      `;

      document.body.appendChild(modal);
    }

    async function handleAbsenModalSubmit(event, siswaId, tanggal, existingId) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const statusAbsen = formData.get('status_absen');

      const absenData = {
        absen_siswa_id: siswaId,
        tanggal_absen: tanggal,
        status_absen: statusAbsen,
        id: existingId || Date.now().toString()
      };

      await saveData('absen', absenData, true);
      
      // Close modal
      const modal = event.target.closest('[style*="position: fixed"]');
      if (modal && modal.parentNode) {
        document.body.removeChild(modal);
      }
    }

    async function deleteAbsenFromModal(absenId) {
      const record = currentData.find(d => d.id === absenId && d.type === 'absen');
      if (record) {
        await deleteData(record);
        showMiniNotification('‚úÖ Absen berhasil dihapus', 'success');
      }
    }

    async function handleAbsenSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('absen', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
      
      // Set tanggal ke hari ini lagi
      event.target.tanggal_absen.value = new Date().toISOString().split('T')[0];
    }

    async function deleteAbsen(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'absen');
      if (record) {
        await deleteData(record);
      }
    }

    function renderHasil() {
      const siswaList = getSiswaList();
      const mapelList = getMapelList();
      const nilaiDetailList = getNilaiDetailList();

      const hasilPerSiswa = siswaList.map(siswa => {
        const hasilMapel = mapelList.map(mapel => {
          const nilaiSiswaMapel = nilaiDetailList.filter(n => 
            n.nilai_detail_siswa_id === siswa.id && n.nilai_detail_mapel === mapel.nama_mapel
          );
          
          let total = 0;
          let count = 0;
          
          nilaiSiswaMapel.forEach(n => {
            if (n.nilai_detail_nilai !== null && n.nilai_detail_nilai !== undefined && n.nilai_detail_nilai !== '') {
              total += parseFloat(n.nilai_detail_nilai);
              count++;
            }
          });

          const rataRata = count > 0 ? (total / count) : 0;

          return {
            mapel: mapel.nama_mapel,
            rataRata: rataRata,
            count: count
          };
        });

        let grandTotal = 0;
        let grandCount = 0;
        
        hasilMapel.forEach(h => {
          if (h.count > 0) {
            grandTotal += h.rataRata;
            grandCount++;
          }
        });

        const rataRataKeseluruhan = grandCount > 0 ? (grandTotal / grandCount) : 0;

        return {
          siswa: siswa,
          hasilMapel: hasilMapel,
          rataRataKeseluruhan: rataRataKeseluruhan
        };
      });

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üìà HASIL BELAJAR SISWA - Kelas ${activeClass}
          </h2>

          ${siswaList.length > 0 && mapelList.length > 0 ? `
            <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                üìä Rekap Nilai Per Siswa
              </h3>
              <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                  <thead>
                    <tr style="background: ${accentColor}; color: white;">
                      <th style="padding: 12px; text-align: left; border: 1px solid rgba(255,255,255,0.2);">No</th>
                      <th style="padding: 12px; text-align: left; border: 1px solid rgba(255,255,255,0.2);">Nama Siswa</th>
                      ${mapelList.map(mapel => `
                        <th style="padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">${mapel.nama_mapel}</th>
                      `).join('')}
                      <th style="padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.2);">Rata-rata</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${hasilPerSiswa.map((hasil, index) => `
                      <tr style="background: ${index % 2 === 0 ? 'var(--bg-color)' : 'var(--card-bg)'};">
                        <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color);">${index + 1}</td>
                        <td style="padding: 12px; border: 1px solid var(--border-color); color: var(--text-color); font-weight: 600;">${hasil.siswa.nama_siswa}</td>
                        ${hasil.hasilMapel.map(h => {
                          let bgColor = 'transparent';
                          let textColor = 'var(--text-color)';
                          
                          if (h.count > 0) {
                            if (h.rataRata >= 85) {
                              bgColor = '#10b981';
                              textColor = 'white';
                            } else if (h.rataRata >= 75) {
                              bgColor = '#3b82f6';
                              textColor = 'white';
                            } else if (h.rataRata >= 65) {
                              bgColor = '#f59e0b';
                              textColor = 'white';
                            } else {
                              bgColor = '#ef4444';
                              textColor = 'white';
                            }
                          }
                          
                          return `
                            <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center;">
                              ${h.count > 0 ? `
                                <span style="padding: 6px 12px; background: ${bgColor}; color: ${textColor}; border-radius: 6px; font-weight: 600; display: inline-block;">
                                  ${h.rataRata.toFixed(2)}
                                </span>
                              ` : `
                                <span style="color: var(--text-color); opacity: 0.5;">-</span>
                              `}
                            </td>
                          `;
                        }).join('')}
                        <td style="padding: 12px; border: 1px solid var(--border-color); text-align: center; background: rgba(${parseInt(accentColor.slice(1,3), 16)}, ${parseInt(accentColor.slice(3,5), 16)}, ${parseInt(accentColor.slice(5,7), 16)}, 0.1);">
                          ${hasil.rataRataKeseluruhan > 0 ? `
                            <span style="font-weight: bold; font-size: 16px; color: ${accentColor};">
                              ${hasil.rataRataKeseluruhan.toFixed(2)}
                            </span>
                          ` : `
                            <span style="color: var(--text-color); opacity: 0.5;">-</span>
                          `}
                        </td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>

              <div style="margin-top: 25px; padding: 20px; background: var(--bg-color); border-radius: 10px; border-left: 4px solid ${accentColor};">
                <h4 style="font-size: 16px; font-weight: bold; margin-bottom: 15px; color: var(--text-color);">
                  üìå Keterangan Warna:
                </h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 30px; height: 30px; background: #10b981; border-radius: 6px;"></span>
                    <span style="color: var(--text-color); font-size: 14px;">‚â• 85 (Sangat Baik)</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 30px; height: 30px; background: #3b82f6; border-radius: 6px;"></span>
                    <span style="color: var(--text-color); font-size: 14px;">75-84 (Baik)</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 30px; height: 30px; background: #f59e0b; border-radius: 6px;"></span>
                    <span style="color: var(--text-color); font-size: 14px;">65-74 (Cukup)</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 30px; height: 30px; background: #ef4444; border-radius: 6px;"></span>
                    <span style="color: var(--text-color); font-size: 14px;">< 65 (Kurang)</span>
                  </div>
                </div>
              </div>
            </div>
          ` : `
            <div class="card-gradient" style="padding: 40px; border-radius: 15px; text-align: center;">
              <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                ${siswaList.length === 0 ? 'Tambahkan data siswa terlebih dahulu.' : 'Tambahkan mata pelajaran dan nilai siswa terlebih dahulu.'}
              </p>
            </div>
          `}
        </div>
      `;
    }

    function renderRPP() {
      const rppList = getRPPList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üìñ RPP/MODUL/VIDEO PEMBELAJARAN
          </h2>

          <form id="rppForm" onsubmit="handleRPPSubmit(event)" class="card-gradient" style="padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
              ‚ûï Tambah Materi Pembelajaran
            </h3>
            <div style="display: grid; gap: 20px;">
              ${renderInput('judul_rpp', 'Judul Materi', '', 'text', true)}
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                  Jenis Materi <span style="color: #ef4444;">*</span>
                </label>
                <select name="jenis_rpp" required style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                  <option value="">Pilih Jenis</option>
                  <option value="RPP">üìÑ RPP (Rencana Pelaksanaan Pembelajaran)</option>
                  <option value="Modul">üìö Modul Pembelajaran</option>
                  <option value="Video">üé• Video Pembelajaran</option>
                  <option value="Presentasi">üìä Presentasi</option>
                  <option value="Lainnya">üìÅ Lainnya</option>
                </select>
              </div>
              ${renderInput('link_rpp', 'Link/URL Materi', '', 'url')}
              ${renderTextarea('deskripsi_rpp', 'Deskripsi/Catatan', '')}
              <button type="submit" style="padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px;">
                ‚ûï SIMPAN MATERI
              </button>
            </div>
          </form>

          <div style="display: grid; gap: 15px;">
            ${rppList.length > 0 ? rppList.map(rpp => {
              const jenisIcons = {
                'RPP': 'üìÑ',
                'Modul': 'üìö',
                'Video': 'üé•',
                'Presentasi': 'üìä',
                'Lainnya': 'üìÅ'
              };
              const jenisColors = {
                'RPP': '#3b82f6',
                'Modul': '#10b981',
                'Video': '#ef4444',
                'Presentasi': '#f59e0b',
                'Lainnya': '#8b5cf6'
              };
              
              return `
                <div class="card-gradient" style="padding: 25px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 5px solid ${jenisColors[rpp.jenis_rpp] || accentColor};">
                  <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 15px; gap: 15px;">
                    <div style="flex: 1;">
                      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <span style="font-size: 32px;">${jenisIcons[rpp.jenis_rpp] || 'üìÅ'}</span>
                        <div>
                          <h3 style="font-size: 20px; font-weight: bold; color: var(--text-color); margin-bottom: 5px;">
                            ${rpp.judul_rpp}
                          </h3>
                          <span style="padding: 4px 12px; background: ${jenisColors[rpp.jenis_rpp] || accentColor}; color: white; border-radius: 6px; font-size: 12px; font-weight: 600;">
                            ${rpp.jenis_rpp}
                          </span>
                        </div>
                      </div>
                      ${rpp.deskripsi_rpp ? `
                        <p style="color: var(--text-color); opacity: 0.8; line-height: 1.6; margin-bottom: 12px; font-size: 14px;">
                          ${rpp.deskripsi_rpp}
                        </p>
                      ` : ''}
                      ${rpp.link_rpp ? `
                        <a href="${rpp.link_rpp}" target="_blank" rel="noopener noreferrer" 
                           style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: ${accentColor}; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 14px; margin-top: 10px;">
                           Buka Materi
                        </a>
                      ` : ''}
                    </div>
                    <button onclick="deleteRPP('${rpp.id}')" 
                            style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                      üóëÔ∏è Hapus
                    </button>
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="card-gradient" style="padding: 40px; border-radius: 10px; text-align: center;">
                <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                  Belum ada materi pembelajaran. Tambahkan materi baru di atas.
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    async function handleRPPSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('rpp', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
    }

    async function deleteRPP(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'rpp');
      if (record) {
        await deleteData(record);
      }
    }

    function renderCatatan() {
      const catatanList = getCatatanList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üìã CATATAN GURU
          </h2>

          <form id="catatanForm" onsubmit="handleCatatanSubmit(event)" class="card-gradient" style="padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
              ‚ûï Tambah Catatan Baru
            </h3>
            <div style="display: grid; gap: 20px;">
              ${renderInput('tanggal_catatan', 'Tanggal', new Date().toISOString().split('T')[0], 'date', true)}
              ${renderInput('judul_catatan', 'Judul Catatan', '', 'text', true)}
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                  Kategori <span style="color: #ef4444;">*</span>
                </label>
                <select name="kategori_catatan" required style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                  <option value="">Pilih Kategori</option>
                  <option value="Penting">üî¥ Penting</option>
                  <option value="Pengingat">üîî Pengingat</option>
                  <option value="Ide">üí° Ide</option>
                  <option value="Evaluasi">üìä Evaluasi</option>
                  <option value="Umum">üìù Umum</option>
                </select>
              </div>
              ${renderTextarea('isi_catatan', 'Isi Catatan', '', true)}
              <button type="submit" style="padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px;">
                ‚ûï SIMPAN CATATAN
              </button>
            </div>
          </form>

          <div style="display: grid; gap: 15px;">
            ${catatanList.length > 0 ? catatanList.sort((a, b) => new Date(b.tanggal_catatan) - new Date(a.tanggal_catatan)).map(catatan => {
              const kategoriIcons = {
                'Penting': 'üî¥',
                'Pengingat': 'üîî',
                'Ide': 'üí°',
                'Evaluasi': 'üìä',
                'Umum': 'üìù'
              };
              const kategoriColors = {
                'Penting': '#ef4444',
                'Pengingat': '#f59e0b',
                'Ide': '#eab308',
                'Evaluasi': '#3b82f6',
                'Umum': '#6b7280'
              };
              
              return `
                <div class="card-gradient" style="padding: 25px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 5px solid ${kategoriColors[catatan.kategori_catatan] || accentColor};">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; gap: 15px;">
                    <div style="flex: 1;">
                      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <span style="font-size: 28px;">${kategoriIcons[catatan.kategori_catatan] || 'üìù'}</span>
                        <div>
                          <h3 style="font-size: 20px; font-weight: bold; color: var(--text-color); margin-bottom: 5px;">
                            ${catatan.judul_catatan}
                          </h3>
                          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <span style="padding: 4px 12px; background: ${kategoriColors[catatan.kategori_catatan] || accentColor}; color: white; border-radius: 6px; font-size: 12px; font-weight: 600;">
                              ${catatan.kategori_catatan}
                            </span>
                            <span style="color: var(--text-color); opacity: 0.7; font-size: 13px;">
                              üìÖ ${new Date(catatan.tanggal_catatan).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </span>
                          </div>
                        </div>
                      </div>
                      <p style="color: var(--text-color); opacity: 0.8; line-height: 1.8; white-space: pre-wrap; font-size: 15px; margin-top: 15px;">
                        ${catatan.isi_catatan}
                      </p>
                    </div>
                    <button onclick="deleteCatatan('${catatan.id}')" 
                            style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                      üóëÔ∏è Hapus
                    </button>
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="card-gradient" style="padding: 40px; border-radius: 10px; text-align: center;">
                <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                  Belum ada catatan. Tambahkan catatan baru di atas.
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    async function handleCatatanSubmit(event) {
      event.preventDefault();
      if (currentData.length >= 999) {
        showToastNotification('Maksimum 999 data tercapai', '‚ö†Ô∏è');
        return;
      }

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      await saveData('catatan', { ...data, id: Date.now().toString() }, true);
      event.target.reset();
      
      // Set tanggal ke hari ini lagi
      event.target.tanggal_catatan.value = new Date().toISOString().split('T')[0];
    }

    async function deleteCatatan(itemId) {
      const record = currentData.find(d => d.id === itemId && d.type === 'catatan');
      if (record) {
        await deleteData(record);
      }
    }

    // ===== FITUR CETAK HASIL BELAJAR =====
    let printSettings = {
      sortBy: 'peringkat', // 'peringkat' atau 'nama'
      paperSize: 'A4',
      orientation: 'landscape',
      scale: 100,
      marginTop: 10,
      marginRight: 10,
      marginBottom: 10,
      marginLeft: 10
    };

    function renderCetak() {
      const siswaList = getSiswaList();
      const mapelList = getMapelList();

      return `
        <div style="color: var(--text-color);">
          <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 30px; color: ${accentColor};">
            üñ®Ô∏è CETAK HASIL BELAJAR SISWA - Kelas ${activeClass}
          </h2>

          ${siswaList.length > 0 && mapelList.length > 0 ? `
            <!-- Tab Navigation -->
            <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid var(--border-color);">
              <button onclick="switchCetakTab('rekap')" id="tabRekap"
                      style="padding: 15px 30px; background: ${accentColor}; color: white; border: none; border-radius: 10px 10px 0 0; cursor: pointer; font-weight: bold; font-size: 16px;">
                üìä REKAP KELAS
              </button>
              <button onclick="switchCetakTab('persiswa')" id="tabPerSiswa"
                      style="padding: 15px 30px; background: var(--card-bg); color: var(--text-color); border: none; border-radius: 10px 10px 0 0; cursor: pointer; font-weight: bold; font-size: 16px;">
                üë§ PER SISWA
              </button>
            </div>

            <!-- Content Rekap Kelas -->
            <div id="contentRekap" style="display: block;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                <!-- Pengaturan Cetak -->
                <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                  <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                    ‚öôÔ∏è Pengaturan Cetak Rekap Kelas
                  </h3>

                  <div style="display: grid; gap: 20px;">
                    <!-- Urutan Data -->
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                        üìä Urutan Data
                      </label>
                      <select id="sortBy" onchange="updatePrintSettings('sortBy', this.value)" 
                              style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                        <option value="peringkat" ${printSettings.sortBy === 'peringkat' ? 'selected' : ''}>
                          üèÜ Berdasarkan Peringkat (Total Nilai Tertinggi)
                        </option>
                        <option value="nama" ${printSettings.sortBy === 'nama' ? 'selected' : ''}>
                          üî§ Berdasarkan Nama Siswa (A-Z)
                        </option>
                      </select>
                    </div>

                    <!-- Ukuran Kertas -->
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                        üìÑ Ukuran Kertas
                      </label>
                      <select id="paperSize" onchange="updatePrintSettings('paperSize', this.value)" 
                              style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                        <option value="A4" ${printSettings.paperSize === 'A4' ? 'selected' : ''}>A4 (210 x 297 mm)</option>
                        <option value="A3" ${printSettings.paperSize === 'A3' ? 'selected' : ''}>A3 (297 x 420 mm)</option>
                        <option value="Letter" ${printSettings.paperSize === 'Letter' ? 'selected' : ''}>Letter (8.5 x 11 inch)</option>
                        <option value="Legal" ${printSettings.paperSize === 'Legal' ? 'selected' : ''}>Legal (8.5 x 14 inch)</option>
                      </select>
                    </div>

                    <!-- Orientasi -->
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                        üîÑ Orientasi
                      </label>
                      <select id="orientation" onchange="updatePrintSettings('orientation', this.value)" 
                              style="width: 100%; padding: 12px; border-radius: 8px; font-size: 14px;">
                        <option value="landscape" ${printSettings.orientation === 'landscape' ? 'selected' : ''}>Landscape (Horizontal)</option>
                        <option value="portrait" ${printSettings.orientation === 'portrait' ? 'selected' : ''}>Portrait (Vertikal)</option>
                      </select>
                    </div>

                    <!-- Skala -->
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color);">
                        üîç Skala: <span id="scaleValue">${printSettings.scale}%</span>
                      </label>
                      <input type="range" id="scale" min="50" max="150" step="5" value="${printSettings.scale}"
                             oninput="updatePrintSettings('scale', this.value); document.getElementById('scaleValue').textContent = this.value + '%'"
                             style="width: 100%; cursor: pointer;">
                    </div>

                    <!-- Margin -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                      <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                          ‚Üë Margin Atas (mm)
                        </label>
                        <input type="number" id="marginTop" value="${printSettings.marginTop}" min="0" max="50"
                               onchange="updatePrintSettings('marginTop', this.value)"
                               style="width: 100%; padding: 10px; border-radius: 8px; font-size: 14px;">
                      </div>
                      <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                          ‚Üí Margin Kanan (mm)
                        </label>
                        <input type="number" id="marginRight" value="${printSettings.marginRight}" min="0" max="50"
                               onchange="updatePrintSettings('marginRight', this.value)"
                               style="width: 100%; padding: 10px; border-radius: 8px; font-size: 14px;">
                      </div>
                      <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                          ‚Üì Margin Bawah (mm)
                        </label>
                        <input type="number" id="marginBottom" value="${printSettings.marginBottom}" min="0" max="50"
                               onchange="updatePrintSettings('marginBottom', this.value)"
                               style="width: 100%; padding: 10px; border-radius: 8px; font-size: 14px;">
                      </div>
                      <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-color); font-size: 13px;">
                          ‚Üê Margin Kiri (mm)
                        </label>
                        <input type="number" id="marginLeft" value="${printSettings.marginLeft}" min="0" max="50"
                               onchange="updatePrintSettings('marginLeft', this.value)"
                               style="width: 100%; padding: 10px; border-radius: 8px; font-size: 14px;">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Info & Tombol Aksi -->
                <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                  <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                    üìã Informasi Dokumen
                  </h3>

                  <div style="background: var(--bg-color); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid ${accentColor};">
                    <div style="display: grid; gap: 12px; font-size: 14px;">
                      <p style="color: var(--text-color); margin: 0;">
                        <strong>üìö Kelas:</strong> ${activeClass}
                      </p>
                      <p style="color: var(--text-color); margin: 0;">
                        <strong>üë• Jumlah Siswa:</strong> ${siswaList.length} siswa
                      </p>
                      <p style="color: var(--text-color); margin: 0;">
                        <strong>üìñ Jumlah Mata Pelajaran:</strong> ${mapelList.length} mapel
                      </p>
                      <p style="color: var(--text-color); margin: 0;">
                        <strong>üë®‚Äçüè´ Wali Kelas:</strong> ${getGuruData().nama_guru || '-'}
                      </p>
                      <p style="color: var(--text-color); margin: 0;">
                        <strong>üÜî NIP:</strong> ${getGuruData().nip || '-'}
                      </p>
                    </div>
                  </div>

                  <div style="background: #e0f2fe; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #0284c7;">
                    <p style="color: #0c4a6e; font-size: 13px; line-height: 1.6; margin: 0;">
                      <strong>‚ÑπÔ∏è Catatan:</strong> Dokumen akan menampilkan rekap nilai siswa dengan kolom: No, Nama Siswa, Nilai per Mata Pelajaran, Total Nilai, dan Rata-rata. Bagian tanda tangan wali kelas akan ditampilkan di bagian bawah dokumen.
                    </p>
                  </div>

                  <div style="display: grid; gap: 12px;">
                    <button onclick="showPreviewRekap()" 
                            style="padding: 15px; background: ${accentColor}; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                      üëÅÔ∏è PREVIEW DOKUMEN
                    </button>
                    <button onclick="printDocumentRekap()" 
                            style="padding: 15px; background: #10b981; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                      üñ®Ô∏è CETAK / DOWNLOAD PDF
                    </button>
                  </div>
                </div>
              </div>

              <!-- Preview Area -->
              <div id="previewAreaRekap" style="display: none;">
                <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: bold; color: var(--text-color); margin: 0;">
                      üëÅÔ∏è Preview Dokumen Rekap Kelas
                    </h3>
                    <button onclick="hidePreviewRekap()" 
                            style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                      ‚úï Tutup
                    </button>
                  </div>
                  <div id="previewContentRekap" style="background: white; padding: 20px; border-radius: 10px; overflow-x: auto; box-shadow: inset 0 0 10px rgba(0,0,0,0.1);">
                    <!-- Preview content will be inserted here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Content Per Siswa -->
            <div id="contentPerSiswa" style="display: none;">
              <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 25px;">
                <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-color);">
                  üë§ Pilih Siswa untuk Cetak Nilai Individual
                </h3>

                <div style="background: #fef3c7; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
                  <p style="color: #92400e; font-size: 13px; line-height: 1.6; margin: 0;">
                    <strong>üí° Info:</strong> Pilih siswa di bawah untuk mencetak hasil rekap nilai individual. Dokumen akan menampilkan nama siswa, nilai per mata pelajaran, total nilai, dan rata-rata dengan tanda tangan wali kelas.
                  </p>
                </div>

                <div style="display: grid; gap: 15px;">
                  ${siswaList.map(siswa => {
                    const nilaiDetailList = getNilaiDetailList();
                    let totalNilai = 0;
                    let totalCount = 0;

                    mapelList.forEach(mapel => {
                      const nilaiSiswaMapel = nilaiDetailList.filter(n => 
                        n.nilai_detail_siswa_id === siswa.id && n.nilai_detail_mapel === mapel.nama_mapel
                      );
                      
                      let total = 0;
                      let count = 0;
                      
                      nilaiSiswaMapel.forEach(n => {
                        if (n.nilai_detail_nilai !== null && n.nilai_detail_nilai !== undefined && n.nilai_detail_nilai !== '') {
                          total += parseFloat(n.nilai_detail_nilai);
                          count++;
                        }
                      });

                      if (count > 0) {
                        totalNilai += (total / count);
                        totalCount++;
                      }
                    });

                    const rataRata = totalCount > 0 ? (totalNilai / totalCount) : 0;

                    return `
                      <div class="card-gradient" style="padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid ${accentColor};">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                          <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                            <span style="font-size: 36px;">${siswa.jenis_kelamin === 'Laki-laki' ? 'üë®‚Äçüéì' : 'üë©‚Äçüéì'}</span>
                            <div>
                              <h4 style="font-size: 18px; font-weight: bold; color: var(--text-color); margin-bottom: 5px;">
                                ${siswa.nama_siswa}
                              </h4>
                              <p style="color: var(--text-color); opacity: 0.7; font-size: 13px; margin: 0;">
                                NISN: ${siswa.nisn || '-'} | Rata-rata: <strong style="color: ${accentColor};">${rataRata > 0 ? rataRata.toFixed(2) : '-'}</strong>
                              </p>
                            </div>
                          </div>
                          <div style="display: flex; gap: 10px;">
                            <button onclick="showPreviewPerSiswa('${siswa.id}')" 
                                    style="padding: 12px 20px; background: ${accentColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; white-space: nowrap;">
                              üëÅÔ∏è Preview
                            </button>
                            <button onclick="printDocumentPerSiswa('${siswa.id}')" 
                                    style="padding: 12px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; white-space: nowrap;">
                              üñ®Ô∏è Cetak
                            </button>
                          </div>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>

              <!-- Preview Area Per Siswa -->
              <div id="previewAreaPerSiswa" style="display: none;">
                <div class="card-gradient" style="padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: bold; color: var(--text-color); margin: 0;">
                      üëÅÔ∏è Preview Dokumen Nilai Siswa
                    </h3>
                    <button onclick="hidePreviewPerSiswa()" 
                            style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                      ‚úï Tutup
                    </button>
                  </div>
                  <div id="previewContentPerSiswa" style="background: white; padding: 20px; border-radius: 10px; overflow-x: auto; box-shadow: inset 0 0 10px rgba(0,0,0,0.1);">
                    <!-- Preview content will be inserted here -->
                  </div>
                </div>
              </div>
            </div>
          ` : `
            <div class="card-gradient" style="padding: 40px; border-radius: 15px; text-align: center;">
              <p style="color: var(--text-color); opacity: 0.7; font-size: 16px;">
                ${siswaList.length === 0 ? 'Tambahkan data siswa terlebih dahulu.' : 'Tambahkan mata pelajaran dan nilai siswa terlebih dahulu.'}
              </p>
            </div>
          `}
        </div>
      `;
    }

    function switchCetakTab(tab) {
      const tabRekap = document.getElementById('tabRekap');
      const tabPerSiswa = document.getElementById('tabPerSiswa');
      const contentRekap = document.getElementById('contentRekap');
      const contentPerSiswa = document.getElementById('contentPerSiswa');

      if (tab === 'rekap') {
        tabRekap.style.background = accentColor;
        tabRekap.style.color = 'white';
        tabPerSiswa.style.background = 'var(--card-bg)';
        tabPerSiswa.style.color = 'var(--text-color)';
        contentRekap.style.display = 'block';
        contentPerSiswa.style.display = 'none';
      } else {
        tabPerSiswa.style.background = accentColor;
        tabPerSiswa.style.color = 'white';
        tabRekap.style.background = 'var(--card-bg)';
        tabRekap.style.color = 'var(--text-color)';
        contentPerSiswa.style.display = 'block';
        contentRekap.style.display = 'none';
      }
    }

    function updatePrintSettings(key, value) {
      if (key === 'scale' || key.includes('margin')) {
        printSettings[key] = parseInt(value);
      } else {
        printSettings[key] = value;
      }
    }

    function generateRekapData() {
      const siswaList = getSiswaList();
      const mapelList = getMapelList();
      const nilaiDetailList = getNilaiDetailList();

      const rekapData = siswaList.map(siswa => {
        const nilaiPerMapel = {};
        let totalNilai = 0;
        let totalCount = 0;

        mapelList.forEach(mapel => {
          const nilaiSiswaMapel = nilaiDetailList.filter(n => 
            n.nilai_detail_siswa_id === siswa.id && n.nilai_detail_mapel === mapel.nama_mapel
          );
          
          let total = 0;
          let count = 0;
          
          nilaiSiswaMapel.forEach(n => {
            if (n.nilai_detail_nilai !== null && n.nilai_detail_nilai !== undefined && n.nilai_detail_nilai !== '') {
              total += parseFloat(n.nilai_detail_nilai);
              count++;
            }
          });

          const rataRata = count > 0 ? (total / count) : 0;
          nilaiPerMapel[mapel.nama_mapel] = rataRata;

          if (count > 0) {
            totalNilai += rataRata;
            totalCount++;
          }
        });

        const rataRataKeseluruhan = totalCount > 0 ? (totalNilai / totalCount) : 0;

        return {
          nama: siswa.nama_siswa,
          nilaiPerMapel: nilaiPerMapel,
          totalNilai: totalNilai,
          rataRata: rataRataKeseluruhan
        };
      });

      // Sort berdasarkan pengaturan
      if (printSettings.sortBy === 'peringkat') {
        rekapData.sort((a, b) => b.totalNilai - a.totalNilai);
      } else {
        rekapData.sort((a, b) => a.nama.localeCompare(b.nama));
      }

      return rekapData;
    }

    function generatePrintHTMLRekap() {
      const guruData = getGuruData();
      const mapelList = getMapelList();
      const rekapData = generateRekapData();
      
      // Hitung ukuran font berdasarkan jumlah mapel
      let fontSize = '10px';
      let headerFontSize = '11px';
      if (mapelList.length > 10) {
        fontSize = '8px';
        headerFontSize = '9px';
      } else if (mapelList.length > 7) {
        fontSize = '9px';
        headerFontSize = '10px';
      }

      const html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Rekap Nilai Siswa Kelas ${activeClass}</title>
          <style>
            @page {
              size: ${printSettings.paperSize} ${printSettings.orientation};
              margin: ${printSettings.marginTop}mm ${printSettings.marginRight}mm ${printSettings.marginBottom}mm ${printSettings.marginLeft}mm;
            }
            
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: Arial, sans-serif;
              color: #000;
              background: white;
              transform: scale(${printSettings.scale / 100});
              transform-origin: top left;
            }
            
            .header {
              text-align: center;
              margin-bottom: 20px;
            }
            
            .header h1 {
              font-size: 16px;
              font-weight: bold;
              margin-bottom: 5px;
              text-transform: uppercase;
            }
            
            .header-line {
              border-bottom: 3px solid #000;
              margin: 10px 0 20px 0;
            }
            
            table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 30px;
              font-size: ${fontSize};
            }
            
            th, td {
              border: 1px solid #000;
              padding: 6px 4px;
              text-align: center;
              vertical-align: middle;
              word-wrap: break-word;
            }
            
            th {
              background-color: #e0e0e0;
              font-weight: bold;
              font-size: ${headerFontSize};
              line-height: 1.2;
            }
            
            .col-no {
              width: 30px;
            }
            
            .col-nama {
              width: 150px;
              text-align: left;
              padding-left: 8px;
            }
            
            .col-mapel {
              min-width: 60px;
              max-width: 80px;
            }
            
            .col-total {
              width: 70px;
              font-weight: bold;
            }
            
            .col-rata {
              width: 70px;
              font-weight: bold;
            }
            
            .signature-section {
              margin-top: 40px;
              display: flex;
              justify-content: flex-end;
            }
            
            .signature-box {
              text-align: center;
              min-width: 200px;
            }
            
            .signature-box p {
              margin: 5px 0;
              font-size: 11px;
            }
            
            .signature-space {
              height: 60px;
            }
            
            .signature-name {
              font-weight: bold;
              text-decoration: underline;
            }
            
            @media print {
              body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>HASIL REKAP NILAI SISWA KELAS ${activeClass}</h1>
            <div class="header-line"></div>
          </div>
          
          <table>
            <thead>
              <tr>
                <th class="col-no">NO</th>
                <th class="col-nama">NAMA SISWA</th>
                ${mapelList.map(mapel => `
                  <th class="col-mapel">${mapel.nama_mapel.toUpperCase()}</th>
                `).join('')}
                <th class="col-total">TOTAL<br>NILAI</th>
                <th class="col-rata">RATA-<br>RATA</th>
              </tr>
            </thead>
            <tbody>
              ${rekapData.map((siswa, index) => `
                <tr>
                  <td class="col-no">${index + 1}</td>
                  <td class="col-nama">${siswa.nama}</td>
                  ${mapelList.map(mapel => {
                    const nilai = siswa.nilaiPerMapel[mapel.nama_mapel];
                    return `<td class="col-mapel">${nilai > 0 ? nilai.toFixed(2) : '-'}</td>`;
                  }).join('')}
                  <td class="col-total">${siswa.totalNilai > 0 ? siswa.totalNilai.toFixed(2) : '-'}</td>
                  <td class="col-rata">${siswa.rataRata > 0 ? siswa.rataRata.toFixed(2) : '-'}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          <div class="signature-section">
            <div class="signature-box">
              <p>Wali Kelas,</p>
              <div class="signature-space"></div>
              <p class="signature-name">${guruData.nama_guru || '___________________'}</p>
              <p>NIP. ${guruData.nip || '___________________'}</p>
            </div>
          </div>
        </body>
        </html>
      `;

      return html;
    }

    function showPreviewRekap() {
      const previewArea = document.getElementById('previewAreaRekap');
      const previewContent = document.getElementById('previewContentRekap');
      
      if (previewArea && previewContent) {
        const html = generatePrintHTMLRekap();
        previewContent.innerHTML = html;
        previewArea.style.display = 'block';
        
        // Scroll to preview
        previewArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function hidePreviewRekap() {
      const previewArea = document.getElementById('previewAreaRekap');
      if (previewArea) {
        previewArea.style.display = 'none';
      }
    }

    function printDocumentRekap() {
      const html = generatePrintHTMLRekap();
      
      // Create a new window for printing
      const printWindow = window.open('', '_blank', 'width=800,height=600');
      
      if (printWindow) {
        printWindow.document.write(html);
        printWindow.document.close();
        
        // Wait for content to load then print
        printWindow.onload = function() {
          setTimeout(() => {
            printWindow.print();
          }, 250);
        };
        
        showMiniNotification('üìÑ Dokumen siap dicetak! Gunakan "Save as PDF" untuk menyimpan.', 'success');
      } else {
        showMiniNotification('‚ö†Ô∏è Pop-up diblokir. Izinkan pop-up untuk mencetak.', 'warning');
      }
    }

    function generatePrintHTMLPerSiswa(siswaId) {
      const guruData = getGuruData();
      const mapelList = getMapelList();
      const siswaList = getSiswaList();
      const nilaiDetailList = getNilaiDetailList();
      
      const siswa = siswaList.find(s => s.id === siswaId);
      if (!siswa) return '';

      // Hitung nilai per mapel untuk siswa ini
      const nilaiPerMapel = {};
      let totalNilai = 0;
      let totalCount = 0;

      mapelList.forEach(mapel => {
        const nilaiSiswaMapel = nilaiDetailList.filter(n => 
          n.nilai_detail_siswa_id === siswa.id && n.nilai_detail_mapel === mapel.nama_mapel
        );
        
        let total = 0;
        let count = 0;
        
        nilaiSiswaMapel.forEach(n => {
          if (n.nilai_detail_nilai !== null && n.nilai_detail_nilai !== undefined && n.nilai_detail_nilai !== '') {
            total += parseFloat(n.nilai_detail_nilai);
            count++;
          }
        });

        const rataRata = count > 0 ? (total / count) : 0;
        nilaiPerMapel[mapel.nama_mapel] = rataRata;

        if (count > 0) {
          totalNilai += rataRata;
          totalCount++;
        }
      });

      const rataRataKeseluruhan = totalCount > 0 ? (totalNilai / totalCount) : 0;

      const html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Rekap Nilai ${siswa.nama_siswa}</title>
          <style>
            @page {
              size: A4 portrait;
              margin: 20mm;
            }
            
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            
            body {
              font-family: Arial, sans-serif;
              color: #000;
              background: white;
              padding: 20px;
            }
            
            .header {
              text-align: center;
              margin-bottom: 30px;
            }
            
            .header h1 {
              font-size: 18px;
              font-weight: bold;
              margin-bottom: 10px;
              text-transform: uppercase;
            }
            
            .header-line {
              border-bottom: 3px solid #000;
              margin: 10px auto;
              width: 100%;
            }
            
            table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 40px;
              font-size: 12px;
            }
            
            th, td {
              border: 1px solid #000;
              padding: 10px;
              text-align: left;
              vertical-align: middle;
            }
            
            th {
              background-color: #e0e0e0;
              font-weight: bold;
              text-align: center;
            }
            
            .col-label {
              width: 40%;
              font-weight: bold;
            }
            
            .col-value {
              width: 60%;
            }
            
            .text-center {
              text-align: center;
            }
            
            .text-right {
              text-align: right;
            }
            
            .signature-section {
              margin-top: 60px;
              display: flex;
              justify-content: flex-end;
            }
            
            .signature-box {
              text-align: center;
              min-width: 200px;
            }
            
            .signature-box p {
              margin: 5px 0;
              font-size: 12px;
            }
            
            .signature-space {
              height: 70px;
            }
            
            .signature-name {
              font-weight: bold;
              text-decoration: underline;
            }
            
            @media print {
              body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
                padding: 0;
              }
              
              @page {
                margin: 20mm;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>HASIL REKAP NILAI ${siswa.nama_siswa.toUpperCase()}</h1>
            <div class="header-line"></div>
          </div>
          
          <table>
            <tr>
              <td class="col-label">NAMA SISWA</td>
              <td class="col-value" colspan="2"><strong>${siswa.nama_siswa}</strong></td>
            </tr>
            <tr>
              <th class="col-label">MATA PELAJARAN</th>
              <th class="text-center" style="width: 20%;">NILAI</th>
              <th class="text-center" style="width: 20%;">KETERANGAN</th>
            </tr>
            ${mapelList.map(mapel => {
              const nilai = nilaiPerMapel[mapel.nama_mapel];
              let keterangan = '-';
              if (nilai > 0) {
                if (nilai >= 85) keterangan = 'Sangat Baik';
                else if (nilai >= 75) keterangan = 'Baik';
                else if (nilai >= 65) keterangan = 'Cukup';
                else keterangan = 'Kurang';
              }
              
              return `
                <tr>
                  <td class="col-label">${mapel.nama_mapel}</td>
                  <td class="text-center"><strong>${nilai > 0 ? nilai.toFixed(2) : '-'}</strong></td>
                  <td class="text-center">${keterangan}</td>
                </tr>
              `;
            }).join('')}
            <tr style="background-color: #f0f0f0;">
              <td class="col-label"><strong>TOTAL NILAI</strong></td>
              <td class="text-center" colspan="2"><strong style="font-size: 14px;">${totalNilai > 0 ? totalNilai.toFixed(2) : '-'}</strong></td>
            </tr>
            <tr style="background-color: #f0f0f0;">
              <td class="col-label"><strong>RATA-RATA</strong></td>
              <td class="text-center" colspan="2"><strong style="font-size: 14px;">${rataRataKeseluruhan > 0 ? rataRataKeseluruhan.toFixed(2) : '-'}</strong></td>
            </tr>
          </table>
          
          <div class="signature-section">
            <div class="signature-box">
              <p>Wali Kelas,</p>
              <div class="signature-space"></div>
              <p class="signature-name">${guruData.nama_guru || '___________________'}</p>
              <p>NIP. ${guruData.nip || '___________________'}</p>
            </div>
          </div>
        </body>
        </html>
      `;

      return html;
    }

    function showPreviewPerSiswa(siswaId) {
      const previewArea = document.getElementById('previewAreaPerSiswa');
      const previewContent = document.getElementById('previewContentPerSiswa');
      
      if (previewArea && previewContent) {
        const html = generatePrintHTMLPerSiswa(siswaId);
        previewContent.innerHTML = html;
        previewArea.style.display = 'block';
        
        // Scroll to preview
        previewArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function hidePreviewPerSiswa() {
      const previewArea = document.getElementById('previewAreaPerSiswa');
      if (previewArea) {
        previewArea.style.display = 'none';
      }
    }

    function printDocumentPerSiswa(siswaId) {
      const html = generatePrintHTMLPerSiswa(siswaId);
      
      // Create a new window for printing
      const printWindow = window.open('', '_blank', 'width=800,height=600');
      
      if (printWindow) {
        printWindow.document.write(html);
        printWindow.document.close();
        
        // Wait for content to load then print
        printWindow.onload = function() {
          setTimeout(() => {
            printWindow.print();
          }, 250);
        };
        
        const siswa = getSiswaList().find(s => s.id === siswaId);
        showMiniNotification(`üìÑ Dokumen nilai ${siswa ? siswa.nama_siswa : ''} siap dicetak!`, 'success');
      } else {
        showMiniNotification('‚ö†Ô∏è Pop-up diblokir. Izinkan pop-up untuk mencetak.', 'warning');
      }
    }

    async function onConfigChange(config) {
      const guruData = getGuruData();
      const titleElements = document.querySelectorAll('.gradient-text');
      titleElements.forEach(el => {
        if (el) {
          el.textContent = (guruData.nama_aplikasi || config.app_title || defaultConfig.app_title) + ' : ' + (guruData.nama_guru || 'Nama Guru');
        }
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title]
        ])
      });
    }

    document.addEventListener('DOMContentLoaded', initApp);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b8506875714a090',t:'MTc2NzQ2OTgzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./Buku Administrasi Digital Guru_files/saved_resource.html"></iframe><script defer="" src="./Buku Administrasi Digital Guru_files/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;version&quot;:&quot;2024.11.0&quot;,&quot;token&quot;:&quot;e3c1c9af36de41759418005494a48906&quot;,&quot;r&quot;:1,&quot;server_timing&quot;:{&quot;name&quot;:{&quot;cfCacheStatus&quot;:true,&quot;cfEdge&quot;:true,&quot;cfExtPri&quot;:true,&quot;cfL4&quot;:true,&quot;cfOrigin&quot;:true,&quot;cfSpeedBrain&quot;:true},&quot;location_startswith&quot;:null}}" crossorigin="anonymous"></script>

</body></html>
